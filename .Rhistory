geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) +
theme_bw() + labs(title = 'GAM model for atopic in first year', x = 'Date of Birth', y = 'is_atopic_first_year')
ggplot(gam_ndl_df, aes(x,y, fill = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')+
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')+
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')
ggplot(gam_ndl_df, aes(x,y, fill = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, col = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = as.factor(Born_at))) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = as.factor(Born_at))) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = as.factor(Born_at)),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
gam_ndl_df$Born_at <- as.factor(gam_ndl_df$Born_at)
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, fill = Born_at),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')# +
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL, ),
alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')# +
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year')# +
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.3) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y, col = Born_at)) + geom_line() +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1, ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') #+
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at)) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1, ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') #+
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at)) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1, ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 10) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1, ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 2) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1, ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1, ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
df_mdl <- df %>% drop_na(SES_group, gender, type_of_pregnancy, mother_education, vaccine_12mo, nursing_setup_at_12mo,
is_atopic_first_year, is_atopic_second_year)
mdl1 <- glm(is_atopic_first_year ~ SES_group + gender + type_of_pregnancy +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children + covid_time  , data = df_mdl, family = "binomial")
mdl1
mdl1$coefficients
mdl1$coefficients$covid_time2
mdl1$coefficients['covid_time2']
gam_ndl_df <- gam_ndl_df %>% mutate(logistic_reg = if_else(x < g1, 0, ifelse(x<g2, mdl1$coefficients['covid_time2'], ifelse(x<g3,mdl1$coefficients['covid_time3'],mdl1$coefficients['covid_time4']))))
gam_ndl_df
gam_ndl_df <- gam_ndl_df %>% mutate(logistic_reg = if_else(x < g1, 0, ifelse(x<g2, mdl1$coefficients['covid_time2'], ifelse(x<g3,mdl1$coefficients['covid_time3'],mdl1$coefficients['covid_time4']))))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(x, logistic_reg)) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1 ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(x, logistic_reg, col = Born_at)) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1 ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(x, logistic_reg, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1 ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
gam_ndl_df <- gam_ndl_df %>% mutate(logistic_reg = if_else(x < g1, 1/2, ifelse(x<g2, mdl1$coefficients['covid_time2'] + 1/2, ifelse(x<g3,mdl1$coefficients['covid_time3']+ 1/2, mdl1$coefficients['covid_time4']+ 1/2))))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(x, logistic_reg, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1 ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
plot(getViz(gam1), shift = coef(gam1)[1])
plot(getViz(gam1))
plot(getViz(gam1), shift = coef(gam1)[1])
plot(getViz(gam1))
plot(getViz(gam1), shift = coef(gam1)[1], trans = plogis)
plot(getViz(gam1), shift = coef(gam1)[1], trans = plogis)
plot(getViz(gam1))
p_prob <- plot(getViz(gam1), shift = coef(gam1)[1], trans = plogis)
p_prob
p_prob$plots[[1]]
p_prob$plots[[1]]$data$fit
p_prob
p_prob <- plot(getViz(gam1), shift = coef(gam1)[1], trans = plogis, pages = 1)
p_prob
gam1 <- gam(is_atopic_first_year ~ SES_group + gender + type_of_pregnancy +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
s(DOB_count, bs='cr') ,data=df_mdl, family=binomial, method = 'REML')
df_mdl$gam1 <- predict.gam(gam1)
df_mdl
summary.gam(gam1)
library(voxel)
library(lmerTest)
library(mgcViz)
p <- plot(getViz(gam1))
x <- p$plots[[1]]$data$fit$x
y <- p$plots[[1]]$data$fit$y
q_alpha = qnorm(0.975)
gam_ndl_df <- p$plots[[1]]$data$fit
gam_ndl_df <- gam_ndl_df %>% mutate(Born_at = if_else(x< g1, 'Up to March19', ifelse(x<g2, 'March19 - March20', ifelse(x<g3,'March20 - Feb21','From Feb21'))))
gam_ndl_df$Born_at <- as.factor(gam_ndl_df$Born_at)
gam_ndl_df <- gam_ndl_df %>% mutate(logistic_reg = if_else(x < g1, 1/2, ifelse(x<g2, mdl1$coefficients['covid_time2'] + 1/2, ifelse(x<g3,mdl1$coefficients['covid_time3']+ 1/2, mdl1$coefficients['covid_time4']+ 1/2))))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(x, logistic_reg, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1 ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
plot(gam1)
gam1 <- gam(is_atopic_first_year ~ SES_group + gender + type_of_pregnancy +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
s(DOB_count, bs='cr') ,data=df_mdl, family=binomial)
gam2 <- gam(is_atopic_second_year ~ SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy  + vaccine_12mo  + nursing_setup_at_12mo + s(DOB_count, bs='cr') ,data=df_mdl, family=binomial)
df_mdl$gam1 <- predict.gam(gam1)
df_mdl$gam2 <- predict.gam(gam2)
summary.gam(gam1)
library(voxel)
library(lmerTest)
library(mgcViz)
p <- plot(getViz(gam1))
x <- p$plots[[1]]$data$fit$x
y <- p$plots[[1]]$data$fit$y
q_alpha = qnorm(0.975)
gam_ndl_df <- p$plots[[1]]$data$fit
gam_ndl_df <- gam_ndl_df %>% mutate(Born_at = if_else(x< g1, 'Up to March19', ifelse(x<g2, 'March19 - March20', ifelse(x<g3,'March20 - Feb21','From Feb21'))))
gam_ndl_df$Born_at <- as.factor(gam_ndl_df$Born_at)
gam_ndl_df <- gam_ndl_df %>% mutate(logistic_reg = if_else(x < g1, 1/2, ifelse(x<g2, mdl1$coefficients['covid_time2'] + 1/2, ifelse(x<g3,mdl1$coefficients['covid_time3']+ 1/2, mdl1$coefficients['covid_time4']+ 1/2))))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(x, logistic_reg, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*q_alpha, ymax = y + se*q_alpha, y=NULL), alpha = 0.1 ) + theme_bw() +
labs(title = 'GAM model for atopic in first year',
x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
gam_ndl_df <- gam_ndl_df %>% mutate(logistic_reg = if_else(x < g1, 0, ifelse(x<g2, mdl1$coefficients['covid_time2'] , ifelse(x<g3,mdl1$coefficients['covid_time3'], mdl1$coefficients['covid_time4']))))
ggplot(gam_ndl_df, aes(x,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(x, logistic_reg, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1 ) +
theme_bw() +
labs(title = 'GAM model for atopic in first year', x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
x
DOB_x <- as.Date(df$DOB_count + min(as.numeric(as.Date(df$DOB))))
DOB_x <- as.Date(gam_ndl_df$x + min(as.numeric(as.Date(df$DOB))))
min(as.numeric(as.Date(df$DOB))))
min(as.numeric(as.Date(df$DOB)))
gam_ndl_df$x
DOB_x <- as.Date(int(gam_ndl_df$x) + min(as.numeric(as.Date(df$DOB))))
df
df_mdl
gam_mdl_df <- gam_mdl_df %>% mutate(dates = as.Date(x + min(as.numeric(as.Date(df$DOB)))))
gam_mdl_df <- p$plots[[1]]$data$fit
gam_mdl_df <- gam_mdl_df %>% mutate(Born_at = if_else(x< g1, 'Up to March19', ifelse(x<g2, 'March19 - March20', ifelse(x<g3,'March20 - Feb21','From Feb21'))))
gam_mdl_df$Born_at <- as.factor(gam_mdl_df$Born_at)
gam_mdl_df <- gam_mdl_df %>%
mutate(logistic_reg = if_else(x < g1, 0, ifelse(x<g2, mdl1$coefficients['covid_time2'] , ifelse(x<g3,mdl1$coefficients['covid_time3'], mdl1$coefficients['covid_time4']))))
gam_mdl_df <- gam_mdl_df %>% mutate(dates = as.Date(x + min(as.numeric(as.Date(df$DOB)))))
plus = min(as.numeric(as.Date(df$DOB)))
plus
gam_mdl_df <- gam_mdl_df %>% mutate(dates = as.Date(x + plus))
gam_mdl_df <- gam_mdl_df %>% mutate(dates = x + plus)
gam_mdl_df
as.Date(17685)
as.Date(17685)
as.Date(17685)
as.Date(17685, origin = 1989)
as.Date(0)
as.Date('1070-01-01')
as.Date('1970-01-01')
as.Date(origion = '1970-01-01')
as.Date(origin = '1970-01-01')
as.Date(17685, origin = '1970-01-01')
gam_mdl_df <- gam_mdl_df %>% mutate(dates = as.Date(x + plus,  origin = '1970-01-01'))
gam_mdl_df
gam_mdl_df <- gam_mdl_df %>% mutate(Date = as.Date(x + plus,  origin = '1970-01-01'))
ggplot(gam_mdl_df, aes(Date,y)) + geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(Date, logistic_reg, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1 ) +
theme_bw() +
labs(title = 'GAM model for atopic in first year', x = 'Date of Birth', y = 'is_atopic_first_year') +
scale_color_manual(values=viridis(4))
df_mdl
columns(df_mdl)
colnames(df_mdl)
colnames(df_mdl)
typical_person <- list(median(SES_group), median(gender), median(type_of_pregnancy),
median(mother_Atopic_diseases), median(father_Atopic_diseases),
mean(mother_year_birth) + mother_education + number_of_children )
mean(mother_year_birth)
median(mother_Atopic_diseases)
mother_education
mean(number_of_children)
typical_person <- list(mode(SES_group), mode(gender), mode(type_of_pregnancy),
mode(mother_Atopic_diseases), mode(father_Atopic_diseases),
mean(mother_year_birth) + mode(mother_education) + mean(number_of_children))
mode(number_of_children)
mode(c(1,1,1,2))
frequency(c(1,1,1,2))
frequency(c(1,1,1,2))
frequency(c(1,1,1,2,2,2,2,2))
frequency(1,1,1,2,2,2,2,2)
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]}
uniqv <- unique(v)
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]}
getmode(c(1,1,1,1,1,3,4,5,6))
getmode(c(1,1,1,1,1,3,4,5,6))
return(uniqv[which.max(tabulate(match(v, uniqv)))])}
return(uniqv[which.max(tabulate(match(v, uniqv)))])}
return(uniqv[which.max(tabulate(match(v, uniqv)))])
getmode <- function(v) {
uniqv <- unique(v)
return(uniqv[which.max(tabulate(match(v, uniqv)))])
}
getmode(c(1,1,1,1,1,3,4,5,6))
getmode(c(1,1,1,1,1,3,4,5,6))
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]}
getmode(c(1,1,1,1,1,3,4,5,6))
getmode(c(1,1,1,1,1,3,4,5,6))
getmode(SES_group)
getmode(gender)
typical_person <- list(getmode(SES_group), getmode(gender), getmode(type_of_pregnancy),
getmode(mother_Atopic_diseases), getmode(father_Atopic_diseases),
mean(mother_year_birth) + getmode(mother_education), getmode(number_of_children))
typical_person <- list(getmode(SES_group), getmode(gender), getmode(type_of_pregnancy),
getmode(mother_Atopic_diseases), getmode(father_Atopic_diseases),
mean(mother_year_birth), getmode(mother_education), getmode(number_of_children))
typical_person
typical_person <- as.data.frame(SES_group = getmode(SES_group), getmode(gender), getmode(type_of_pregnancy),
getmode(mother_Atopic_diseases), getmode(father_Atopic_diseases),
mean(mother_year_birth), getmode(mother_education), getmode(number_of_children))
typical_person <- as.data.frame(SES_group = getmode(SES_group))
typical_person <- data.frame(SES_group = getmode(SES_group))
typical_person
=
mother_Atopic_diseases = getmode(mother_Atopic_diseases), father_Atopic_diseases = getmode(father_Atopic_diseases), mother_year_birth = mean(mother_year_birth), mother_education = getmode(mother_education), number_of_children = getmode(number_of_children))
number_of_children = getmode(number_of_children))
typical_person <- data.frame(SES_group = getmode(SES_group, gender = getmode(gender),
type_of_pregnancy = getmode(type_of_pregnancy),
mother_Atopic_diseases = getmode(mother_Atopic_diseases),
father_Atopic_diseases = getmode(father_Atopic_diseases),
mother_year_birth = mean(mother_year_birth),
mother_education = getmode(mother_education),
number_of_children = getmode(number_of_children)))
typical_person <- data.frame(SES_group = getmode(SES_group, gender = getmode(gender),
type_of_pregnancy = getmode(type_of_pregnancy),
mother_Atopic_diseases = getmode(mother_Atopic_diseases),
father_Atopic_diseases = getmode(father_Atopic_diseases),
mother_year_birth = mean(mother_year_birth),
mother_education = getmode(mother_education),
number_of_children = getmode(number_of_children)))
typical_person <- data.frame(SES_group = getmode(SES_group),
gender = getmode(gender),
type_of_pregnancy = getmode(type_of_pregnancy),
mother_Atopic_diseases = getmode(mother_Atopic_diseases),
father_Atopic_diseases = getmode(father_Atopic_diseases),
mother_year_birth = mean(mother_year_birth),
mother_education = getmode(mother_education),
number_of_children = getmode(number_of_children)))
typical_person <- data.frame(SES_group = getmode(SES_group),
gender = getmode(gender),
type_of_pregnancy = getmode(type_of_pregnancy),
mother_Atopic_diseases = getmode(mother_Atopic_diseases),
father_Atopic_diseases = getmode(father_Atopic_diseases),
mother_year_birth = mean(mother_year_birth),
mother_education = getmode(mother_education),
number_of_children = getmode(number_of_children)))
typical_person <- data.frame(SES_group = getmode(SES_group),
gender = getmode(gender),
type_of_pregnancy = getmode(type_of_pregnancy),
mother_Atopic_diseases = getmode(mother_Atopic_diseases),
father_Atopic_diseases = getmode(father_Atopic_diseases),
mother_year_birth = mean(mother_year_birth),
mother_education = getmode(mother_education),
number_of_children = getmode(number_of_children)))
typical_person <- data.frame(SES_group = getmode(SES_group),
gender = getmode(gender),
type_of_pregnancy = getmode(type_of_pregnancy),
mother_Atopic_diseases = getmode(mother_Atopic_diseases),
father_Atopic_diseases = getmode(father_Atopic_diseases),
mother_year_birth = mean(mother_year_birth),
mother_education = getmode(mother_education),
number_of_children = getmode(number_of_children))
typical_person
typical_person * 100
[typical_person] * 100
rep(typical_person, 10)
typical_person <- data.frame(SES_group = getmode(SES_group),
gender = getmode(gender),
type_of_pregnancy = getmode(type_of_pregnancy),
mother_Atopic_diseases = getmode(mother_Atopic_diseases),
father_Atopic_diseases = getmode(father_Atopic_diseases),
mother_year_birth = mean(mother_year_birth),
mother_education = getmode(mother_education),
number_of_children = getmode(number_of_children))
n <- length(df)
n
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir <- "C:/Users/shahars/OneDrive - Playtika Ltd/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
df <- df %>% filter(is.na(lost_of_followup))# Filtering only participants that completed the survey
df <- df %>% filter(month_survey_complete == 2) # Filtering only participants that completed the second year
df <- df[,-c(51:88)]# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)] # Removing columns with alot on NA:
# Adding binary columns
df$family_Atopic_diseases_sum <- rowSums(df[,14:37]) # Did any one from family (mother, father, sib) have *any* of the disease?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17]) # Did a disease appear in a specific family member?
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# df = df %>% mutate(sibling_Atopic_diseases_sum = ifelse(number_of_children ==0, NA, sibling_Atopic_diseases_sum)) # inseret NA to sibiling atopic disease when there is no Sibilings
# Sum each disease
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
# Binary variable for each family member
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
df <- df %>% mutate(SES_group = ifelse(SES>8, '9-10', ifelse(SES>5, '6-8', '1-5')))# create a category SES variable :
#Creating dependent variables with the correct name
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
df$feeding_type <- df$study_group_COMEET
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_count = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# Change categorical variable to factors
df$feeding_type <- as.factor(df$feeding_type)
df$mother_education <- as.factor(df$mother_education)
df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
df$nursing_setup_at_12mo <- as.factor(df$nursing_setup_at_12mo)
df$covid_time <- as.factor(df$covid_time)
df <- df %>% drop_na(is_atopic_first_year, is_atopic_second_year)
attach(df)
n <- length(df_mdl)
n
df_mdl
n <- length(df_mdl$record_id)
n
typical_person <- data.frame(SES_group = rep(getmode(SES_group),n),
gender = rep(getmode(gender,n)),
type_of_pregnancy = rep(getmode(type_of_pregnancy,n)),
mother_Atopic_diseases = rep(getmode(mother_Atopic_diseases,n)),
father_Atopic_diseases = rep(getmode(father_Atopic_diseases,n)),
mother_year_birth = rep(mean(mother_year_birth,n)),
mother_education = rep(getmode(mother_education,n)),
number_of_children = rep(getmode(number_of_children,n)))
typical_person <- data.frame(SES_group = rep(getmode(SES_group),n),
gender = rep(getmode(gender),n),
type_of_pregnancy = rep(getmode(type_of_pregnancy),n),
mother_Atopic_diseases = rep(getmode(mother_Atopic_diseases),n),
father_Atopic_diseases = rep(getmode(father_Atopic_diseases),n),
mother_year_birth = rep(mean(mother_year_birth),n),
mother_education = rep(getmode(mother_education),n),
number_of_children = rep(getmode(number_of_children),n))
typical_person
typical_person
typical_person <- typical_person %>% mutate(DOB = df_mdl$DOB, DOB_count = df_mdl$DOB_count)
typical_person
predict.gam(gam1, typical_person)
typical_person$predict <- predict.gam(gam1, typical_person)
typical_person
ggplot(typical_person, aes(DOB, predict)) + geom_points()
ggplot(typical_person, aes(DOB, predict)) + geom_point()
typical_person$predict <- predict.gam(gam1, typical_person, type = 'response')
ggplot(typical_person, aes(DOB, predict)) + geom_point()
ggplot(typical_person, aes(DOB, predict)) + geom_line()
ggplot(typical_person, aes(DOB + 365, predict)) + geom_line()
ggplot(typical_person, aes(DOB, predict)) + geom_line()
