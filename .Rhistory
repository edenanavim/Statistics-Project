geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution - During the first year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the first year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the secound year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
res_log2 = as.data.frame(summary(mdl2)$coefficients)
df_gam2 <- plot(getViz(gam2))$plots[[1]]$data$fit
df_gam2 <- df_gam2 %>% mutate(Born_at = if_else(x< g1, 'Up to March19',
ifelse(x<g2, 'March19 - March20', ifelse(x<g3,'March20 - Feb21','From Feb21'))))
df_gam2$Born_at <- as.factor(df_gam2$Born_at)
df_gam2 <- df_gam2 %>% mutate(y_log = if_else(x < g1, 0,
ifelse(x<g2, mdl2$coefficients['covid_time2'] ,
ifelse(x<g3 ,mdl2$coefficients['covid_time3'], mdl2$coefficients['covid_time4']))),
se_log = if_else(x < g1, res_log2['(Intercept)', 'Std. Error'],
ifelse(x<g2, res_log2['covid_time2', 'Std. Error'] ,
ifelse(x<g3 , res_log2['covid_time3', 'Std. Error'],
res_log2['covid_time4', 'Std. Error']))))
#set dates
plus = min(as.numeric(as.Date(df$DOB)))
df_gam2 <- df_gam2 %>% mutate(Date = as.Date(x + plus,  origin = '1970-01-01'))
## with Intercept:
g2_interc = gam2$coefficients[1]
l2_interc = mdl2$coefficients[1]
df_gam2$y <- df_gam2$y + g2_interc
df_gam2$y_log <- df_gam2$y_log + l2_interc
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the secound year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(6)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(7)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(10)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(3)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4), begin =1) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4), begin = 1) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4, begin = 1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4, begin = 2)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(4, begin = 1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5, begin = 1)) + scale_fill_manual(values=mako(4, begin = 1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5, begin = 1)) + scale_fill_manual(values=mako(5, begin = 1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5, begin = 1)) + scale_fill_manual(values=mako(5, begin = 0.1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5, begin = 0.1)) + scale_fill_manual(values=mako(5, begin = 0.1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(4, begin = 0.1)) + scale_fill_manual(values=mako(5, begin = 0.1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(4, begin = 0.1)) + scale_fill_manual(values=mako(4, begin = 0.1)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(4, begin = 0.1)) + scale_fill_manual(values=mako(4, begin = 0.5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=mako(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=mako(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the first year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(6)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=viridis(6)) + scale_fill_manual(values=viridis(6)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), , alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Date of birth coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Date of Birth', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)
# Creating prediction of atopic disease for typical person
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]}
n <- length(df_mdl$record_id) # number of rows in the data
# Data frame that contained the typical person n times in order to predict atopic diseas
typical_person <- data.frame(SES_group = rep(getmode(SES_group),n),
gender = rep(getmode(gender),n),
type_of_pregnancy = rep(getmode(type_of_pregnancy),n),
mother_Atopic_diseases = rep(getmode(mother_Atopic_diseases),n),
father_Atopic_diseases = rep(getmode(father_Atopic_diseases),n),
mother_year_birth = rep(mean(df_mdl$mother_year_birth),n),
mother_education = rep(getmode(mother_education),n),
number_of_children = rep(getmode(number_of_children),n),
nursing_setup_at_12mo = rep(getmode(nursing_setup_at_12mo),n),
vaccine_12mo = rep(getmode(vaccine_12mo),n))
# adding DOB for each observation
typical_person <- typical_person %>% mutate(DOB = df_mdl$DOB, DOB_count = df_mdl$DOB_count)
typical_person <- typical_person %>% mutate(Born_at = if_else(DOB_count< g1, 'Up to March19', ifelse(DOB_count<g2, 'March19 - March20', ifelse(DOB_count<g3,'March20 - Feb21','From Feb21'))), covid_time = if_else(DOB_count< g1, 1, ifelse(DOB_count<g2, 2, ifelse(DOB_count<g3,3,4))))
typical_person$covid_time <- as.factor(typical_person$covid_time)
# predict
typical_person$gam_predict_first_year <- predict.gam(gam1, typical_person, type = 'response')
typical_person$gam_predict_second_year <- predict.gam(gam2, typical_person, type = 'response')
typical_person$reg_predict_first_year <- predict(mdl1, typical_person, type = 'response')
typical_person$reg_predict_second_year <- predict(mdl2, typical_person, type = 'response')
typical_person$gam_p_se1 <- predict.gam(gam1, typical_person, type = 'response', se.fit=TRUE)$se.fit
typical_person$gam_p_se2 <- predict.gam(gam2, typical_person, type = 'response', se.fit=TRUE)$se.fit
typical_person$reg_p_se1 <- predict(mdl1, typical_person, type = 'response', se.fit=TRUE)$se.fit
typical_person$reg_p_se2 <- predict(mdl2, typical_person, type = 'response', se.fit=TRUE)$se.fit
# Plot the predictions :
ggplot(typical_person, aes(DOB, gam_predict_first_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = gam_predict_first_year - gam_p_se1*qnorm(0.975), ymax = gam_predict_first_year + gam_p_se1*qnorm(0.975), y = NULL, fill = Born_at, col = Born_at), alpha=0.1)+
geom_line(aes(DOB, reg_predict_first_year, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = reg_predict_first_year - reg_p_se1*qnorm(0.975), ymax = reg_predict_first_year + reg_p_se1*qnorm(0.975), y = NULL, fill = Born_at), alpha=0.1)+
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = "Atopic disease risk - During the first year of a baby's life" , x = 'Date of Birth', y = 'Probability')
ggplot(typical_person, aes(DOB, gam_predict_second_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = gam_predict_second_year - gam_p_se2*qnorm(0.975), ymax = gam_predict_second_year + gam_p_se2*qnorm(0.975), y=NULL, col=Born_at, fill=Born_at), alpha=0.1)+
geom_line(aes(DOB, reg_predict_second_year, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = reg_predict_second_year - reg_p_se2*qnorm(0.975), ymax = reg_predict_second_year + reg_p_se2*qnorm(0.975), y = NULL, fill = Born_at), alpha=0.1)+
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = "Atopic disease risk - During the second year of a baby's life" , x = 'Date of Birth', y = 'Probability')
ggplot(typical_person, aes(DOB, gam_predict_second_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = gam_predict_second_year - gam_p_se2*qnorm(0.975), ymax = gam_predict_second_year + gam_p_se2*qnorm(0.975), y=NULL, col=Born_at, fill=Born_at), alpha=0.1)+
geom_line(aes(DOB, reg_predict_second_year, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = reg_predict_second_year - reg_p_se2*qnorm(0.975), ymax = reg_predict_second_year + reg_p_se2*qnorm(0.975), y = NULL, fill = Born_at), alpha=0.1)+
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = "Atopic disease risk", subtitle = "During the second year of a baby's life" , x = 'Date of Birth', y = 'Probability')
# Plot the predictions :
ggplot(typical_person, aes(DOB, gam_predict_first_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = gam_predict_first_year - gam_p_se1*qnorm(0.975), ymax = gam_predict_first_year + gam_p_se1*qnorm(0.975), y = NULL, fill = Born_at, col = Born_at), alpha=0.1)+
geom_line(aes(DOB, reg_predict_first_year, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = reg_predict_first_year - reg_p_se1*qnorm(0.975), ymax = reg_predict_first_year + reg_p_se1*qnorm(0.975), y = NULL, fill = Born_at), alpha=0.1)+
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = "Atopic disease risk", subtitle = "During the first year of a baby's life" , x = 'Date of Birth', y = 'Probability')
# Creating prediction of atopic disease for typical person
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]}
n <- length(df_mdl$record_id) # number of rows in the data
# Data frame that contained the typical person n times in order to predict atopic diseas
typical_person <- data.frame(SES_group = rep(getmode(SES_group),n),
gender = rep(getmode(gender),n),
type_of_pregnancy = rep(getmode(type_of_pregnancy),n),
mother_Atopic_diseases = rep(getmode(mother_Atopic_diseases),n),
father_Atopic_diseases = rep(getmode(father_Atopic_diseases),n),
mother_year_birth = rep(mean(df_mdl$mother_year_birth),n),
mother_education = rep(getmode(mother_education),n),
number_of_children = rep(getmode(number_of_children),n),
nursing_setup_at_12mo = rep(getmode(nursing_setup_at_12mo),n),
vaccine_12mo = rep(getmode(vaccine_12mo),n),
baby_number= rep(1,n))
set.seed(111)
typical_person_2 <- data.frame(SES_group = rep(sample(unique(na.omit(SES_group)),1),n),
gender = rep(sample(unique(na.omit(gender)),1),n),
type_of_pregnancy = rep(sample(unique(na.omit(type_of_pregnancy)),1),n),
mother_Atopic_diseases = rep(sample(unique(na.omit(mother_Atopic_diseases)),1),n),
father_Atopic_diseases = rep(sample(unique(na.omit(father_Atopic_diseases)),1),n),
mother_year_birth = rep(sample(unique(na.omit(df_mdl$mother_year_birth)),1),n),
mother_education = rep(sample(unique(na.omit(mother_education)),1),n),
number_of_children = rep(sample(unique(na.omit(number_of_children)),1),n),
nursing_setup_at_12mo = rep(sample(unique(na.omit(nursing_setup_at_12mo)),1),n),
vaccine_12mo = rep(sample(unique(na.omit(vaccine_12mo)),1),n),
baby_number= rep(2,n))
typical_person_3 <- data.frame(SES_group = rep(sample(unique(na.omit(SES_group)),1),n),
gender = rep(sample(unique(na.omit(gender)),1),n),
type_of_pregnancy = rep(sample(unique(na.omit(type_of_pregnancy)),1),n),
mother_Atopic_diseases = rep(sample(unique(na.omit(mother_Atopic_diseases)),1),n),
father_Atopic_diseases = rep(sample(unique(na.omit(father_Atopic_diseases)),1),n),
mother_year_birth = rep(sample(unique(na.omit(df_mdl$mother_year_birth)),1),n),
mother_education = rep(sample(unique(na.omit(mother_education)),1),n),
number_of_children = rep(sample(unique(na.omit(number_of_children)),1),n),
nursing_setup_at_12mo = rep(sample(unique(na.omit(nursing_setup_at_12mo)),1),n),
vaccine_12mo = rep(sample(unique(na.omit(vaccine_12mo)),1),n),
baby_number= rep(3,n))
typical_person_4 <- data.frame(SES_group = rep(sample(unique(na.omit(SES_group)),1),n),
gender = rep(sample(unique(na.omit(gender)),1),n),
type_of_pregnancy = rep(sample(unique(na.omit(type_of_pregnancy)),1),n),
mother_Atopic_diseases = rep(sample(unique(na.omit(mother_Atopic_diseases)),1),n),
father_Atopic_diseases = rep(sample(unique(na.omit(father_Atopic_diseases)),1),n),
mother_year_birth = rep(sample(unique(na.omit(df_mdl$mother_year_birth)),1),n),
mother_education = rep(sample(unique(na.omit(mother_education)),1),n),
number_of_children = rep(sample(unique(na.omit(number_of_children)),1),n),
nursing_setup_at_12mo = rep(sample(unique(na.omit(nursing_setup_at_12mo)),1),n),
vaccine_12mo = rep(sample(unique(na.omit(vaccine_12mo)),1),n),
baby_number= rep(4,n))
# adding DOB for each observation
#first baby
typical_person <- typical_person %>% mutate(DOB = df_mdl$DOB, DOB_count = df_mdl$DOB_count)
typical_person <- typical_person %>% mutate(Born_at = if_else(DOB_count< g1, 'Up to March19', ifelse(DOB_count<g2, 'March19 - March20', ifelse(DOB_count<g3,'March20 - Feb21','From Feb21'))), covid_time = if_else(DOB_count< g1, 1, ifelse(DOB_count<g2, 2, ifelse(DOB_count<g3,3,4))))
typical_person$covid_time <- as.factor(typical_person$covid_time)
#second baby
typical_person_2 <- typical_person_2 %>% mutate(DOB = df_mdl$DOB, DOB_count = df_mdl$DOB_count)
typical_person_2 <- typical_person_2 %>% mutate(Born_at = if_else(DOB_count< g1, 'Up to March19', ifelse(DOB_count<g2, 'March19 - March20', ifelse(DOB_count<g3,'March20 - Feb21','From Feb21'))), covid_time = if_else(DOB_count< g1, 1, ifelse(DOB_count<g2, 2, ifelse(DOB_count<g3,3,4))))
typical_person_2$covid_time <- as.factor(typical_person_2$covid_time)
#third baby
typical_person_3 <- typical_person_3 %>% mutate(DOB = df_mdl$DOB, DOB_count = df_mdl$DOB_count)
typical_person_3 <- typical_person_3 %>% mutate(Born_at = if_else(DOB_count< g1, 'Up to March19', ifelse(DOB_count<g2, 'March19 - March20', ifelse(DOB_count<g3,'March20 - Feb21','From Feb21'))), covid_time = if_else(DOB_count< g1, 1, ifelse(DOB_count<g2, 2, ifelse(DOB_count<g3,3,4))))
typical_person_3$covid_time <- as.factor(typical_person_3$covid_time)
#fourth baby
typical_person_4 <- typical_person_4 %>% mutate(DOB = df_mdl$DOB, DOB_count = df_mdl$DOB_count)
typical_person_4 <- typical_person_4 %>% mutate(Born_at = if_else(DOB_count< g1, 'Up to March19', ifelse(DOB_count<g2, 'March19 - March20', ifelse(DOB_count<g3,'March20 - Feb21','From Feb21'))), covid_time = if_else(DOB_count< g1, 1, ifelse(DOB_count<g2, 2, ifelse(DOB_count<g3,3,4))))
typical_person_4$covid_time <- as.factor(typical_person_4$covid_time)
typical_person <- rbind(typical_person,typical_person_2,typical_person_3,typical_person_4)
# predict
typical_person$gam_predict_first_year <- predict.gam(gam1, typical_person, type = 'response')
typical_person$gam_predict_second_year <- predict.gam(gam2, typical_person, type = 'response')
typical_person$reg_predict_first_year <- predict(mdl1, typical_person, type = 'response')
typical_person$reg_predict_second_year <- predict(mdl2, typical_person, type = 'response')
# ggplot(typical_person,aes(DOB, gam_predict_first_year)) +
#   geom_line(aes(color=as.factor(baby_number),linetype =Born_at ) ,size = 1)+
#   geom_line(aes(DOB, reg_predict_first_year,color=as.factor(baby_number),linetype =Born_at ),size = 1)+
#   scale_linetype_manual(values = c("dotdash","dotted","dashed", "solid"))
#
# ggplot(typical_person,aes(DOB, gam_predict_first_year)) +
#   geom_line(aes(color=as.factor(baby_number)) ,size = 1)+
#   geom_line(aes(DOB, reg_predict_first_year,color=as.factor(baby_number)),size = 1)+
#   geom_vline(xintercept = c(as.Date("2019-03-01")+1,as.Date("2020-03-11")+1,as.Date("2021-02-07")+1), size=1.5)
# Plot the predictions :
# first year
baby_1_1Y <- ggplot(typical_person %>% filter(baby_number == 1), aes(DOB, gam_predict_first_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_first_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = '', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.5,1))#+
#theme(legend.position = "none")
baby_2_1Y <- ggplot(typical_person %>% filter(baby_number == 2), aes(DOB, gam_predict_first_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_first_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = 'Prob to atopic disease in first year using GAM and Log reggression', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.5,1))#+
#theme(legend.position = "none")
baby_3_1Y <- ggplot(typical_person %>% filter(baby_number == 3), aes(DOB, gam_predict_first_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_first_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = 'Prob to atopic disease in first year using GAM and Log reggression', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.5,1))#+
#theme(legend.position = "none")
baby_4_1Y <- ggplot(typical_person %>% filter(baby_number == 4), aes(DOB, gam_predict_first_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_first_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = 'Prob to atopic disease in first year using GAM and Log reggression', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.5,1))
plot_grid(baby_1_1Y, baby_2_1Y, baby_3_1Y, baby_4_1Y, ncol = 2)
# second year:
baby_1_2Y <- ggplot(typical_person %>% filter(baby_number == 1), aes(DOB, gam_predict_second_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_second_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = 'Prob to atopic disease in first year using GAM and Log reggression', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.2,0.8))#+
#theme(legend.position = "none")
baby_2_2Y <- ggplot(typical_person %>% filter(baby_number == 2), aes(DOB, gam_predict_second_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_second_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = 'Prob to atopic disease in first year using GAM and Log reggression', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.2,0.8))#+
#theme(legend.position = "none")
baby_3_2Y <- ggplot(typical_person %>% filter(baby_number == 3), aes(DOB, gam_predict_second_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_second_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = 'Prob to atopic disease in first year using GAM and Log reggression', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.2,0.8))#+
#theme(legend.position = "none")
baby_4_2Y <- ggplot(typical_person %>% filter(baby_number == 4), aes(DOB, gam_predict_second_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_line(aes(DOB, reg_predict_second_year, col = Born_at), size = 1) +
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = 'Prob to atopic disease in first year using GAM and Log reggression', x = 'Date of Birth', y = 'Prob')+
ylim(c(0.2,0.8))
plot_grid(baby_1_2Y, baby_2_2Y, baby_3_2Y, baby_4_2Y, ncol = 2)
# Creating prediction of atopic disease for typical person
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]}
n <- length(df_mdl$record_id) # number of rows in the data
# Data frame that contained the typical person n times in order to predict atopic diseas
typical_person <- data.frame(SES_group = rep(getmode(SES_group),n),
gender = rep(getmode(gender),n),
type_of_pregnancy = rep(getmode(type_of_pregnancy),n),
mother_Atopic_diseases = rep(getmode(mother_Atopic_diseases),n),
father_Atopic_diseases = rep(getmode(father_Atopic_diseases),n),
mother_year_birth = rep(mean(df_mdl$mother_year_birth),n),
mother_education = rep(getmode(mother_education),n),
number_of_children = rep(getmode(number_of_children),n),
nursing_setup_at_12mo = rep(getmode(nursing_setup_at_12mo),n),
vaccine_12mo = rep(getmode(vaccine_12mo),n))
# adding DOB for each observation
typical_person <- typical_person %>% mutate(DOB = df_mdl$DOB, DOB_count = df_mdl$DOB_count)
typical_person <- typical_person %>% mutate(Born_at = if_else(DOB_count< g1, 'Up to March19', ifelse(DOB_count<g2, 'March19 - March20', ifelse(DOB_count<g3,'March20 - Feb21','From Feb21'))), covid_time = if_else(DOB_count< g1, 1, ifelse(DOB_count<g2, 2, ifelse(DOB_count<g3,3,4))))
typical_person$covid_time <- as.factor(typical_person$covid_time)
# predict
typical_person$gam_predict_first_year <- predict.gam(gam1, typical_person, type = 'response')
typical_person$gam_predict_second_year <- predict.gam(gam2, typical_person, type = 'response')
typical_person$reg_predict_first_year <- predict(mdl1, typical_person, type = 'response')
typical_person$reg_predict_second_year <- predict(mdl2, typical_person, type = 'response')
typical_person$gam_p_se1 <- predict.gam(gam1, typical_person, type = 'response', se.fit=TRUE)$se.fit
typical_person$gam_p_se2 <- predict.gam(gam2, typical_person, type = 'response', se.fit=TRUE)$se.fit
typical_person$reg_p_se1 <- predict(mdl1, typical_person, type = 'response', se.fit=TRUE)$se.fit
typical_person$reg_p_se2 <- predict(mdl2, typical_person, type = 'response', se.fit=TRUE)$se.fit
# Plot the predictions :
ggplot(typical_person, aes(DOB, gam_predict_first_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = gam_predict_first_year - gam_p_se1*qnorm(0.975), ymax = gam_predict_first_year + gam_p_se1*qnorm(0.975), y = NULL, fill = Born_at, col = Born_at), alpha=0.1)+
geom_line(aes(DOB, reg_predict_first_year, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = reg_predict_first_year - reg_p_se1*qnorm(0.975), ymax = reg_predict_first_year + reg_p_se1*qnorm(0.975), y = NULL, fill = Born_at), alpha=0.1)+
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = "Atopic disease risk", subtitle = "During the first year of a baby's life" , x = 'Date of Birth', y = 'Probability')
ggplot(typical_person, aes(DOB, gam_predict_second_year)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = gam_predict_second_year - gam_p_se2*qnorm(0.975), ymax = gam_predict_second_year + gam_p_se2*qnorm(0.975), y=NULL, col=Born_at, fill=Born_at), alpha=0.1)+
geom_line(aes(DOB, reg_predict_second_year, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = reg_predict_second_year - reg_p_se2*qnorm(0.975), ymax = reg_predict_second_year + reg_p_se2*qnorm(0.975), y = NULL, fill = Born_at), alpha=0.1)+
scale_color_manual(values=viridis(4)) + scale_fill_manual(values=viridis(4)) + theme_bw() +
labs(title = "Atopic disease risk", subtitle = "During the second year of a baby's life" , x = 'Date of Birth', y = 'Probability')
getmode(SES_group)
