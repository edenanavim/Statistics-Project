ggplot(df_mdl, aes(DOB, gam2)) + geom_smooth() + geom_line(aes(DOB, mdl2_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=wes.palette(n=4, name="GrandBudapest"), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
# Seconde year - No Sibilings
ggplot(df_mdl, aes(DOB, gam2)) + geom_smooth() + geom_line(aes(DOB, mdl2_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=c('#4393C3', '#F4A582', '#92C5DE', '#D6604D'), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
# Seconde year - With Sibilings
ggplot(df_mdl, aes(DOB, gam2_sib)) + geom_smooth() + geom_line(aes(DOB, mdl2_sib_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB - WITH SIBILINGS', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
library(viridis)
install.packages("viridis")
library(viridis)
# Seconde year - With Sibilings
ggplot(df_mdl, aes(DOB, gam2_sib)) + geom_smooth() + geom_line(aes(DOB, mdl2_sib_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB - WITH SIBILINGS', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
# Seconde year - With Sibilings
ggplot(df_mdl, aes(DOB, gam2_sib)) + geom_smooth(aes(col = viridis(4))) + geom_line(aes(DOB, mdl2_sib_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB - WITH SIBILINGS', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
# Seconde year - With Sibilings
ggplot(df_mdl, aes(DOB, gam2_sib)) + geom_smooth(aes(col = covid_time)) + geom_line(aes(DOB, mdl2_sib_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB - WITH SIBILINGS', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
design = theme_bw()
# First year - No Sibilings
ggplot(df_mdl, aes(DOB, gam1)) + geom_smooth(aes(col = covid_time)) + geom_line(aes(DOB, mdl1_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for babies up to one year old by DOB', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
# First year - With Sibilings
ggplot(df_mdl, aes(DOB, gam1_sib)) + geom_smooth(aes(col = covid_time)) + geom_line(aes(DOB, mdl1_sib_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for babies up to one year old by DOB - WITH SIBILINGS', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
# Seconde year - No Sibilings
ggplot(df_mdl, aes(DOB, gam2)) + geom_smooth(aes(col = covid_time)) + geom_line(aes(DOB, mdl2_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' ))+ ylim(0.5,1)
# Seconde year - With Sibilings
ggplot(df_mdl, aes(DOB, gam2_sib)) + geom_smooth(aes(col = covid_time)) + geom_line(aes(DOB, mdl2_sib_avg, col = covid_time)) +
design + labs(title = 'Atopic disease risk for 1-2 year old babies by DOB - WITH SIBILINGS', x = 'Date of Birth', y = 'Atopic disease probability') +
scale_color_manual(values=viridis(4), name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21' )) + ylim(0.5,1)
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
library(mgcv)
library(nlme)
library(Matrix)
library(lme4)
library(wesanderson)
library(viridis)
options(scipen=5, digits = 5)
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
library(mgcv)
library(nlme)
library(Matrix)
library(lme4)
library(wesanderson)
library(viridis)
options(scipen=5, digits = 5)
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# Filtering only participants that completed the second year:
df <- df %>% filter(month_survey_complete == 2)
# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
#remove_columns = colnames(df)[51:88]
df <- df[,-c(51:88)]
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
df <- df %>% filter(is.na(lost_of_followup))# Filtering only participants that completed the survey
df <- df %>% filter(month_survey_complete == 2) # Filtering only participants that completed the second year
df <- df[,-c(51:88)]# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)] # Removing columns with alot on NA:
# Adding binary columns
df$family_Atopic_diseases_sum <- rowSums(df[,14:37]) # Did any one from family (mother, father, sib) have *any* of the disease?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17]) # Did a disease appear in a specific family member?
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# df = df %>% mutate(sibling_Atopic_diseases_sum = ifelse(number_of_children ==0, NA, sibling_Atopic_diseases_sum)) # inseret NA to sibiling atopic disease when there is no Sibilings
# Sum each disease
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
# Binary variable for each family member
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
df <- df %>% mutate(SES_group = ifelse(SES>8, '9-10', ifelse(SES>5, '6-8', ifelse(SES>2, '3-5', '1-2'))))# create a category SES variable :
#Creating dependent variables with the correct name
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
df$feeding_type <- df$study_group_COMEET
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_count = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# Change categorical variable to factors
df$feeding_type <- as.factor(df$feeding_type)
df$mother_education <- as.factor(df$mother_education)
df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
df$nursing_setup_at_12mo <- as.factor(df$nursing_setup_at_12mo)
df$covid_time <- as.factor(df$covid_time)
attach(df)
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
library(mgcv)
library(nlme)
library(Matrix)
library(lme4)
library(wesanderson)
library(viridis)
options(scipen=5, digits = 5)
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
df <- df %>% filter(is.na(lost_of_followup))# Filtering only participants that completed the survey
df <- df %>% filter(month_survey_complete == 2) # Filtering only participants that completed the second year
df <- df[,-c(51:88)]# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)] # Removing columns with alot on NA:
# Adding binary columns
df$family_Atopic_diseases_sum <- rowSums(df[,14:37]) # Did any one from family (mother, father, sib) have *any* of the disease?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17]) # Did a disease appear in a specific family member?
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# df = df %>% mutate(sibling_Atopic_diseases_sum = ifelse(number_of_children ==0, NA, sibling_Atopic_diseases_sum)) # inseret NA to sibiling atopic disease when there is no Sibilings
# Sum each disease
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
# Binary variable for each family member
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
df <- df %>% mutate(SES_group = ifelse(SES>8, '9-10', ifelse(SES>5, '6-8', ifelse(SES>2, '3-5', '1-2'))))# create a category SES variable :
#Creating dependent variables with the correct name
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
df$feeding_type <- df$study_group_COMEET
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_count = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# Change categorical variable to factors
df$feeding_type <- as.factor(df$feeding_type)
df$mother_education <- as.factor(df$mother_education)
df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
df$nursing_setup_at_12mo <- as.factor(df$nursing_setup_at_12mo)
df$covid_time <- as.factor(df$covid_time)
attach(df)
df_sib = df %>% mutate(sibling_Atopic_diseases_sum = ifelse(number_of_children ==0, NA, sibling_Atopic_diseases_sum)) # inseret NA to sibiling atopic disease when there is no Sibilings
# define siblings df
sibilings_df <- df_sib %>% select(number_of_children,is_atopic_first_year, is_atopic_second_year, sibling_Atopic_diseases_sum) %>% mutate(sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum >0, 1, ifelse(is.na(sibling_Atopic_diseases_sum), NA, 0))) %>% filter(number_of_children > 0)
sibilings_df
sum(sibilings_df %>%  filter(is_atopic_first_year >0, number_of_children > 0) %>%  select(sibling_Atopic_diseases), na.rm =T) / sum(sibilings_df$sibling_Atopic_diseases, na.rm =T)
# number of sick siblings from sick kids that have siblings
sum(sibilings_df %>%  filter(is_atopic_first_year >0, number_of_children > 0) %>%  select(sibling_Atopic_diseases), na.rm =T) / sum(sibilings_df$sibling_Atopic_diseases, na.rm =T)
sum(sibilings_df %>%  filter(is_atopic_second_year >0, number_of_children > 0) %>%  select(sibling_Atopic_diseases), na.rm =T)/ sum(sibilings_df$sibling_Atopic_diseases, na.rm =T)
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_first_year), na.rm =T)
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_second_year), na.rm =T)
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_first_year), na.rm =T)
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_second_year), na.rm =T)
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_first_year), na.rm =T) / count(sibilings_df %>%  filter(number_of_children >0) %>%  select(number_of_children), na.rm =T)
count(sibilings_df %>%  filter(number_of_children >0) %>%  select(number_of_children), na.rm =T)
count(sibilings_df %>%  filter(number_of_children >0) %>%  select(number_of_children))
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_first_year), na.rm =T) / count(sibilings_df %>%  filter(number_of_children >0) %>%  select(number_of_children))
# number of sick siblings from sick kids that have siblings
sum(sibilings_df %>%  filter(is_atopic_first_year >0, number_of_children > 0) %>%  select(sibling_Atopic_diseases), na.rm =T) / sum(sibilings_df$sibling_Atopic_diseases, na.rm =T)
sum(sibilings_df %>%  filter(is_atopic_second_year >0, number_of_children > 0) %>%  select(sibling_Atopic_diseases), na.rm =T)/ sum(sibilings_df$sibling_Atopic_diseases, na.rm =T)
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_first_year), na.rm =T) / count(sibilings_df %>%  filter(number_of_children >0) %>%  select(number_of_children))
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_first_year), na.rm =T) / count(sibilings_df %>%  filter(number_of_children >0) %>%  select(number_of_children))
sum(sibilings_df %>%  filter(number_of_children >0) %>%  select(is_atopic_second_year), na.rm =T) / count(sibilings_df %>%  filter(number_of_children >0) %>%  select(number_of_children))
sibilings_df
df_sib
df
# define siblings df
sibilings_df <- df_sib %>% select(record_id,number_of_children,is_atopic_first_year, is_atopic_second_year, sibling_Atopic_diseases_sum) %>% mutate(sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum >0, 1, ifelse(is.na(sibling_Atopic_diseases_sum), NA, 0))) %>% filter(number_of_children > 0)
sibilings_df
sibilings_df$is_atopic_first_year
# Num of sick kids from the ones who have siblings
sum(sibilings_df$is_atopic_first_year) / count(sibilings_df %>% filter(number_of_children >0) %>%  select(number_of_children))
sum(sibilings_df$is_atopic_first_year) / count(sibilings_df %>% filter(number_of_children >0) %>%  select(number_of_children))
sibilings_df$number_of_children
count(sibilings_df$number_of_children)
# define siblings df
sibilings_df <- df_sib %>% select(record_id, number_of_children, is_atopic_first_year, is_atopic_second_year, sibling_Atopic_diseases_sum) %>%
mutate(have_siblings = ifelse(number_of_children >0, 1, 0))
sibilings_df
sibilings_df %>% group_by(have_siblings) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year))
sibilings_df %>% group_by(have_siblings) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(have_siblings), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df %>% group_by(have_siblings) %>%  summarise(n = count(have_siblings), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n_distinct(have_siblings), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(have_siblings), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n0(have_siblings), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(have_siblings), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sibilings_df$is_atopic_second_year = sibilings_df$is_atopic_second_year / sibilings_df$n
sibilings_df$is_atopic_first_year_perc = sibilings_df$is_atopic_first_year / sibilings_df$n
sibilings_df$n
sibilings_df
sib_group <- sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sib_group$is_atopic_first_year_perc = sib_group$is_atopic_first_year / sib_group$n
sib_group$is_atopic_second_year = sib_group$is_atopic_second_year / sib_group$n
sib_group
sibilings_df
sib_group
df_sib
sibilings_df
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(is_atopic_first_year) %>%  summarise(sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum))
is_atopic_df1
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(is_atopic_first_year) %>%  summarise(sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T))
is_atopic_df1
sibilings_df
# Check diff between babies with / without siblings
sibilings_df <- df_sib %>% select(record_id, number_of_children, is_atopic_first_year, is_atopic_second_year, sibling_Atopic_diseases_sum) %>%
mutate(have_siblings = ifelse(number_of_children >0, 1, 0), sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum>0,1,0))
sib_group <- sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sib_group$is_atopic_first_year_perc = sib_group$is_atopic_first_year / sib_group$n
sib_group$is_atopic_second_year = sib_group$is_atopic_second_year / sib_group$n
sib_group
sibilings_df
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(is_atopic_first_year, have_siblings) %>%  summarise(sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T))
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(is_atopic_first_year, have_siblings) %>%  summarise(sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
is_atopic_df1
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(have_siblings, is_atopic_first_year) %>%  summarise(sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
is_atopic_df1
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(have_siblings, is_atopic_first_year) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_years, ibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
is_atopic_df1
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(have_siblings, is_atopic_first_year) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_years), ibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(have_siblings, is_atopic_first_year) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_years), sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(have_siblings, is_atopic_first_year) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_year), sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
is_atopic_df1
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(have_siblings) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_year), sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
is_atopic_df1
sib_group
# insert NA to siblings atopic disease when there is no siblings
df_sib = df %>% mutate(sibling_Atopic_diseases_sum = ifelse(number_of_children ==0, NA, sibling_Atopic_diseases_sum))
# Check diff between babies with / without siblings
sibilings_df <- df_sib %>% select(record_id, number_of_children, is_atopic_first_year, is_atopic_second_year, sibling_Atopic_diseases_sum) %>%
mutate(have_siblings = ifelse(number_of_children >0, 1, 0), sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum>0,1,0))
sib_group <- sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sib_group$is_atopic_first_year_perc = sib_group$is_atopic_first_year / sib_group$n
sib_group$is_atopic_second_year_perc = sib_group$is_atopic_second_year / sib_group$n
sib_group
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(have_siblings) %>%  summarise(is_atopic_first_year = sum(is_atopic_first_year), sibling_Atopic_diseases_sum = sum(sibling_Atopic_diseases_sum, na.rm=T), .groups='drop')
is_atopic_df1
sib_group
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(is_atopic_first_year) %>%  summarise(n = n(), sibling_Atopic_diseases = sum(sibling_Atopic_diseases, na.rm=T), .groups='drop')
is_atopic_df1
is_atopic_df1$perc = is_atopic_df1$sibling_Atopic_diseases/ is_atopic_df1$n
is_atopic_df1
is_atopic_df2 <- sibilings_df %>% group_by(is_atopic_second_year) %>%  summarise(n = n(), sibling_Atopic_diseases = sum(sibling_Atopic_diseases, na.rm=T), .groups='drop')
is_atopic_df2$perc = is_atopic_df2$sibling_Atopic_diseases/ is_atopic_df2$n
is_atopic_df2
df <- df %>% drop_na(is_atopic_first_year, is_atopic_second_year)
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
library(mgcv)
library(nlme)
library(Matrix)
library(lme4)
library(wesanderson)
library(viridis)
options(scipen=5, digits = 5)
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
df <- df %>% filter(is.na(lost_of_followup))# Filtering only participants that completed the survey
df <- df %>% filter(month_survey_complete == 2) # Filtering only participants that completed the second year
df <- df[,-c(51:88)]# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)] # Removing columns with alot on NA:
# Adding binary columns
df$family_Atopic_diseases_sum <- rowSums(df[,14:37]) # Did any one from family (mother, father, sib) have *any* of the disease?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17]) # Did a disease appear in a specific family member?
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# df = df %>% mutate(sibling_Atopic_diseases_sum = ifelse(number_of_children ==0, NA, sibling_Atopic_diseases_sum)) # inseret NA to sibiling atopic disease when there is no Sibilings
# Sum each disease
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
# Binary variable for each family member
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
df <- df %>% mutate(SES_group = ifelse(SES>8, '9-10', ifelse(SES>5, '6-8', ifelse(SES>2, '3-5', '1-2'))))# create a category SES variable :
#Creating dependent variables with the correct name
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
df$feeding_type <- df$study_group_COMEET
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_count = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# Change categorical variable to factors
df$feeding_type <- as.factor(df$feeding_type)
df$mother_education <- as.factor(df$mother_education)
df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
df$nursing_setup_at_12mo <- as.factor(df$nursing_setup_at_12mo)
df$covid_time <- as.factor(df$covid_time)
df <- df %>% drop_na(is_atopic_first_year, is_atopic_second_year)
attach(df)
# insert NA to siblings atopic disease when there is no siblings
df_sib = df %>% mutate(sibling_Atopic_diseases_sum = ifelse(number_of_children ==0, NA, sibling_Atopic_diseases_sum))
# Check diff between babies with / without siblings
sibilings_df <- df_sib %>% select(record_id, number_of_children, is_atopic_first_year, is_atopic_second_year, sibling_Atopic_diseases_sum) %>%
mutate(have_siblings = ifelse(number_of_children >0, 1, 0), sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum>0,1,0))
sib_group <- sibilings_df %>% group_by(have_siblings) %>%  summarise(n = n(), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year, na.rm=T))
sib_group$is_atopic_first_year_perc = sib_group$is_atopic_first_year / sib_group$n
sib_group$is_atopic_second_year_perc = sib_group$is_atopic_second_year / sib_group$n
sib_group
# check diff of sick siblings between is_atopic
is_atopic_df1 <- sibilings_df %>% group_by(is_atopic_first_year) %>%  summarise(n = n(), sibling_Atopic_diseases = sum(sibling_Atopic_diseases, na.rm=T), .groups='drop')
is_atopic_df1$perc = is_atopic_df1$sibling_Atopic_diseases/ is_atopic_df1$n
is_atopic_df1
is_atopic_df2 <- sibilings_df %>% group_by(is_atopic_second_year) %>%  summarise(n = n(), sibling_Atopic_diseases = sum(sibling_Atopic_diseases, na.rm=T), .groups='drop')
is_atopic_df2$perc = is_atopic_df2$sibling_Atopic_diseases/ is_atopic_df2$n
is_atopic_df2
sibilings_df
cor(sibilings_df$have_siblings, sibilings_df$is_atopic_first_year)
cor(sibilings_df$have_siblings, sibilings_df$is_atopic_second_year)
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year)
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, na.rm = T)
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, na.rm = False)
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, na.rm = FALSE)
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, na.rm = TRUE)
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, na.rm = TRUE)
sibilings_df$sibling_Atopic_diseases
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, use = "complete")
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, use = "all.obs")
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, use = "complete.obs")
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, use = "na.or.complete")
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, use = "pairwise.complete.obs")
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_second_year, use = "pairwise.complete.obs")
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_first_year, use = "pairwise.complete.obs")
cor(sibilings_df$sibling_Atopic_diseases, sibilings_df$is_atopic_second_year, use = "pairwise.complete.obs")
