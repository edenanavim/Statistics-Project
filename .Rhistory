ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('×©', 'darkorange1', 'green4'),name = "Group")
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('a', 'darkorange1', 'green4'),name = "Group")
e
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Group", labels =c('a','b','c'))
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Group", labels =c('Up to March19 ','March19 - March20','March20 - Feb21'))
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19 ','March19 - March20','March20 - Feb21'))
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19 ','March19 - March20','March20 - Feb21')) + xlab("")
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19 ','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = c('','',''))
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = c('a','b','c'))
ggplot(atopic_longer_count, aes(covid_time, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = element_text(c('a','b','c')))
atopic_longer_count
atopic_longer_count <- atopic_longer_count %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
atopic_longer_count
ggplot(atopic_longer_count, aes(Born_at, y = count, fill = as.factor(covid_time))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) #+ scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = element_text(c('a','b','c')))
ggplot(atopic_longer_count, aes(Born_at, y = count, fill = as.factor(Born_at))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = element_text(c('a','b','c')))
ggplot(atopic_longer_count, aes(Born_at, y = count, fill = as.factor(Born_at))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = element_text(angel = 90))
ggplot(atopic_longer_count, aes(Born_at, y = count, fill = as.factor(Born_at))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = element_text(angle  = 90))
ggplot(atopic_longer_count, aes(Born_at, y = count, fill = as.factor(Born_at))) + geom_col() +theme_bw() + facet_wrap(~chronic_disease,2,4) + scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) + xlab("") + theme(axis.text.x = element_text(angle  = 90, colour='white'))
plot_df_1 <- df %>% select(covid_time, AD_first_year, AD_24_month, FA_first_year,food_allergy_24_month, ABX_fisrt_year,inhalation_24_month) %>% group_by(covid_time) %>% summarise(AD_first_year = sum(AD_first_year), AD_24_month = sum(AD_24_month), FA_first_year = sum(FA_first_year),food_allergy_24_month = sum(food_allergy_24_month), ABX_fisrt_year = sum(ABX_fisrt_year),inhalation_24_month = sum(inhalation_24_month)) %>% gather(chronic_disease, count, AD_first_year:inhalation_24_month, factor_key=TRUE)
plot_df_2 <- df %>% select(covid_time,is_atopic_first_year,is_atopic_second_year) %>% group_by(covid_time) %>% summarise(is_atopic_first_year= sum(is_atopic_first_year), is_atopic_second_year= sum(is_atopic_second_year)) %>% gather(chronic_disease, count, is_atopic_first_year:is_atopic_second_year, factor_key=TRUE)
ggplot(plot_df_1,aes(x=chronic_disease, y= count, fill = as.factor(covid_time))) +
geom_col() + xlab("Chronic Disease") + ylab("Cases") +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Group")
ggplot(plot_df_2,aes(x=chronic_disease, y= count, fill = as.factor(covid_time))) +
geom_col(position = "dodge")+ xlab("Chronic Disease") + ylab("Cases") +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Group")# + scale_fill_discrete(name = "Group")
plot_df_3 <- df %>% select(SES,is_atopic_first_year,is_atopic_second_year) %>% drop_na() %>% group_by(SES) %>% summarise(is_atopic_first_year= sum(is_atopic_first_year), is_atopic_second_year= sum(is_atopic_second_year)) %>% gather(chronic_disease, count, is_atopic_first_year:is_atopic_second_year, factor_key=TRUE)
plot_df_3 <- df %>% select(SES,is_atopic_first_year,is_atopic_second_year) %>% drop_na() %>% group_by(SES) %>% summarise(is_atopic_first_year= mean(is_atopic_first_year), is_atopic_second_year= mean(is_atopic_second_year)) %>% gather(chronic_disease, count, is_atopic_first_year:is_atopic_second_year, factor_key=TRUE)
ggplot(plot_df_3,aes(x=as.factor(SES), y= count, fill = as.factor(chronic_disease))) +
geom_col(position = "dodge") + scale_fill_discrete(name = "Group")+ xlab("SES") + ylab("Cases") +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'))
table(SES)
plot_df_88 <- df %>% select(number_of_ABX_first_year,is_atopic_first_year,is_atopic_second_year,AD_first_year, AD_24_month, FA_first_year,food_allergy_24_month, ABX_fisrt_year,inhalation_24_month) %>% drop_na() %>% group_by(number_of_ABX_first_year) %>% summarise(is_atopic_first_year= mean(is_atopic_first_year), is_atopic_second_year= mean(is_atopic_second_year),AD_first_year = mean(AD_first_year), AD_24_month = mean(AD_24_month), FA_first_year = mean(FA_first_year),food_allergy_24_month = mean(food_allergy_24_month), ABX_fisrt_year = mean(ABX_fisrt_year),inhalation_24_month = mean(inhalation_24_month)) %>% gather(chronic_disease, mean, is_atopic_first_year:inhalation_24_month, factor_key=TRUE)
ggplot(plot_df_88,aes(x=as.factor(chronic_disease), y= mean, fill = as.factor(number_of_ABX_first_year))) +
geom_col(position = "dodge") + scale_fill_discrete(name = "number_of_ABX_first_year")+ xlab("chronic_disease") + ylab("percent of disease")# +scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'))
plot_df_1 <- df %>% select(covid_time, AD_first_year, AD_24_month, FA_first_year,food_allergy_24_month, ABX_fisrt_year,inhalation_24_month) %>% group_by(covid_time) %>% summarise(AD_first_year = sum(AD_first_year), AD_24_month = sum(AD_24_month), FA_first_year = sum(FA_first_year),food_allergy_24_month = sum(food_allergy_24_month), ABX_fisrt_year = sum(ABX_fisrt_year),inhalation_24_month = sum(inhalation_24_month)) %>% gather(chronic_disease, count, AD_first_year:inhalation_24_month, factor_key=TRUE)
plot_df_2 <- df %>% select(covid_time,is_atopic_first_year,is_atopic_second_year) %>% group_by(covid_time) %>% summarise(is_atopic_first_year= sum(is_atopic_first_year), is_atopic_second_year= sum(is_atopic_second_year)) %>% gather(chronic_disease, count, is_atopic_first_year:is_atopic_second_year, factor_key=TRUE)
ggplot(plot_df_1,aes(x=chronic_disease, y= count, fill = as.factor(covid_time))) +
geom_col() + xlab("Chronic Disease") + ylab("Cases") +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Group") + theme_bw()
ggplot(plot_df_2,aes(x=chronic_disease, y= count, fill = as.factor(covid_time))) + theme_bw() +
geom_col(position = "dodge")+ xlab("Chronic Disease") + ylab("Cases") +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),name = "Group")# + scale_fill_discrete(name = "Group")
abx_count <- df %>% select(c(exploreatory_variables, number_of_ABX_first_year)) %>% drop_na() %>%
group_by(number_of_ABX_first_year) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
abx_count
View(atopic_longer_count)
abx_count
abx_count
ggplot(abx_count, aes(chronic_disease, count)) + geom_col
ggplot(abx_count, aes(chronic_disease, count)) + geom_col()
ggplot(abx_count, aes(chronic_disease, count, fill = as.factor(number_of_ABX_first_year))) + geom_col()
ggplot(abx_count, aes(chronic_disease, count, fill = as.factor(number_of_ABX_first_year))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,2,4)
ggplot(abx_count, aes(chronic_disease, count, fill = as.factor(number_of_ABX_first_year))) + geom_bar() + theme_bw() +facet_wrap(~chronic_disease,2,4)
ggplot(abx_count, aes(number_of_ABX_first_year, count, fill = as.factor(number_of_ABX_first_year))) + geom_bar() + theme_bw() +facet_wrap(~chronic_disease,2,4)
ggplot(abx_count, aes(number_of_ABX_first_year, count, fill = as.factor(number_of_ABX_first_year))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,2,4)
#number_of_ABX_first_year vs is atopic
```{r}
abx_count <- df %>% select(c(exploreatory_variables, number_of_ABX_first_year)) %>% drop_na() %>%
group_by(number_of_ABX_first_year) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
ggplot(abx_count, aes(number_of_ABX_first_year, count, fill = as.factor(number_of_ABX_first_year))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,2,4)
ggplot(abx_count, aes(number_of_ABX_first_year, count, fill = as.factor(number_of_ABX_first_year))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,2,4)
ggplot(atopic_longer_count, aes(Born_at, y = count, fill = as.factor(Born_at))) +
geom_col() + theme_bw() +
facet_wrap(~chronic_disease,2,4) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text(angle  = 90, colour='white'))
ggplot(abx_count, aes(number_of_ABX_first_year, count, fill = as.factor(number_of_ABX_first_year))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,2,4)
ggplot(abx_count, aes(number_of_ABX_first_year, count, fill = as.factor(number_of_ABX_first_year))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,4,2)
abx_count
abx_count <- abx_count %>% filter(number_of_ABX_first_year >0)
ggplot(abx_count, aes(number_of_ABX_first_year, count, fill = as.factor(number_of_ABX_first_year))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,4,2)
plot_df_8 <- df %>% select(number_ABX_treatment_24_months,is_atopic_first_year,is_atopic_second_year,AD_first_year, AD_24_month, FA_first_year,food_allergy_24_month, ABX_fisrt_year,inhalation_24_month) %>% drop_na() %>% group_by(number_ABX_treatment_24_months) %>% summarise(is_atopic_first_year= mean(is_atopic_first_year), is_atopic_second_year= mean(is_atopic_second_year),AD_first_year = mean(AD_first_year), AD_24_month = mean(AD_24_month), FA_first_year = mean(FA_first_year),food_allergy_24_month = mean(food_allergy_24_month), ABX_fisrt_year = mean(ABX_fisrt_year),inhalation_24_month = mean(inhalation_24_month)) %>% gather(chronic_disease, mean, is_atopic_first_year:inhalation_24_month, factor_key=TRUE)
ggplot(plot_df_8,aes(x=as.factor(chronic_disease), y= mean, fill = as.factor(number_ABX_treatment_24_months))) +
geom_col(position = "dodge") + scale_fill_discrete(name = "number_ABX_treatment_24_months")+ xlab("chronic_disease") + ylab("percent of disease")# +scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'))
abx24_count <- df %>% select(c(exploreatory_variables, number_ABX_treatment_24_months)) %>% drop_na() %>%
group_by(number_ABX_treatment_24_months) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
abx24_count <- abx24_count %>% filter(number_ABX_treatment_24_months >0)
ggplot(abx24_count, aes(number_ABX_treatment_24_months, count, fill = as.factor(number_ABX_treatment_24_months))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,4,2)
## number_ABX_treatment_24_months vs is atopic
```{r}
abx24_count <- df %>% select(c(exploreatory_variables, number_ABX_treatment_24_months)) %>% drop_na() %>%
group_by(number_ABX_treatment_24_months) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
abx24_count <- abx24_count %>% filter(number_ABX_treatment_24_months >0)
ggplot(abx24_count, aes(number_ABX_treatment_24_months, count, fill = as.factor(number_ABX_treatment_24_months))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,4,2)
abx24_count <- df %>% select(c(exploreatory_variables, number_ABX_treatment_24_months)) %>% drop_na() %>%
group_by(number_ABX_treatment_24_months) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
abx24_count <- abx24_count %>% filter(number_ABX_treatment_24_months >0)
ggplot(abx24_count, aes(number_ABX_treatment_24_months, count, fill = as.factor(number_ABX_treatment_24_months))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,4,2)
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
options(scipen=5, digits = 5)
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
options(scipen=5, digits = 5)
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_3.1.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_3.1.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_3.1.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# Filtering only participants that completed the second year:
df <- df %>% filter(month_survey_complete == 2)
# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
#remove_columns = colnames(df)[51:88]
df <- df[,-c(51:88)]
# Removing columns with allot on NA:
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)]
# Adding binary columns
# A. Did any one from family (mother, father, sib) have *any* of the disease?
df$family_Atopic_diseases_sum <- rowSums(df[,14:37])
# B. Did somebody from family have a specific disease?
# NEED TO FILL IN
# C. Did a disease appear in a specific family member?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17])
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# Sibilings
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
#Creating dependent variables:
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year)>0,1,0),
is_atopic_second_year = ifelse((food_allergy_24_month + inhalation_24_month + AD_24_month)>0,1,0))
#option B of explanatory var:
#From mail
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
table(df$covid_time)
# at this moment there is no sutible data from group 4 - post corona
attach(df)
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
# MASBIR
full_binari_exp <- c('Jew/Arab', 'gender', 'Allergy_total',
'mother_asthma', 'mother_atopic_dermatitis', 'mother_Allergic_rhinitis', 'mother_food_allergy',
'father_asthma', 'father_atopic_dermatitis', 'father_Allergic_rhinitis', 'father_food_allergy',
'sibling1_asthma', 'sibling1_atopic_dermatitis', 'sibling1_Allergic_rhinitis', 'sibling1_food_allergy',
'sibling2_asthma', 'sibling2_atopic_dermatitis', 'sibling2_Allergic_rhinitis', 'sibling2_food_allergy',
'sibling3_asthma', 'sibling3_atopic_dermatitis', 'sibling3_Allergic_rhinitis', 'sibling3_food_allergy',
'sibling4_asthma', 'sibling4_atopic_dermatitis', 'sibling4_Allergic_rhinitis', 'sibling4_food_allergy',
'vaccine_12mo', 'prevention_therapy', 'steroids_treatment24',
'hospitalization_24_months', 'chronic_disease_24',
'family_Atopic_diseases', 'mother_Atopic_diseases', 'father_Atopic_diseases', 'sibling_Atopic_diseases')
binari_exp <- c('Jew/Arab', 'gender', 'Allergy_total',
'mother_asthma', 'mother_atopic_dermatitis', 'mother_Allergic_rhinitis', 'mother_food_allergy',
'father_asthma', 'father_atopic_dermatitis', 'father_Allergic_rhinitis', 'father_food_allergy',
'vaccine_12mo', 'prevention_therapy',
'family_Atopic_diseases', 'mother_Atopic_diseases', 'father_Atopic_diseases', 'sibling_Atopic_diseases')
continues_exp <- c('mother_year_birth', 'DOB', 'mother_education')
discrite_exp <- c('SES', 'number_of_children', 'preganancy_number', 'number_of_ABX_first_year', 'number_inhalation',
'family_Atopic_diseases_sum', 'mother_Atopic_diseases_sum', 'father_Atopic_diseases_sum', 'sibling_Atopic_diseases_sum',
'sibling_asthma_sum', 'sibling_AD_sum', 'sibling_Allergic_rhinitis_sum', 'sibling_FA_sum')
categoric_exp <- c('type_of_pregnancy', 'nursing_setup_at_12mo', 'covid_time')
#MOOSBAR
exploreatory_variables <- c('HRAD_first_year', 'AD_first_year', 'FA_first_year',
'HRAD_second_year', 'AD_second_year', 'FA_second_year',
'is_atopic_first_year', 'is_atopic_second_year')
covid_time_table <- function(kpi){
return(list(perc = round(ftable(covid_time, df[[kpi]]) / rowSums(ftable(covid_time, df[[kpi]])),3),
n = table(covid_time, df[[kpi]])))}
# sapply(binari_exp, covid_time_table, simplify =FALSE)
# sapply(discrite_exp, covid_time_table, simplify =FALSE)
# sapply(categoric_exp, covid_time_table, simplify =FALSE)
# sapply(exploreatory_variables, covid_time_table, simplify =FALSE)
plot_df_10 <- df %>% select(nursing_setup_at_12mo,is_atopic_first_year,is_atopic_second_year,AD_first_year, AD_24_month, FA_first_year,food_allergy_24_month, ABX_fisrt_year,inhalation_24_month) %>% drop_na() %>% group_by(nursing_setup_at_12mo) %>% summarise(is_atopic_first_year= mean(is_atopic_first_year), is_atopic_second_year= mean(is_atopic_second_year),AD_first_year = mean(AD_first_year), AD_24_month = mean(AD_24_month), FA_first_year = mean(FA_first_year),food_allergy_24_month = mean(food_allergy_24_month), ABX_fisrt_year = mean(ABX_fisrt_year),inhalation_24_month = mean(inhalation_24_month)) %>% gather(chronic_disease, mean, is_atopic_first_year:inhalation_24_month, factor_key=TRUE)
ggplot(plot_df_10,aes(x=as.factor(chronic_disease), y= mean, fill = as.factor(nursing_setup_at_12mo))) +
geom_col(position = "dodge") + scale_fill_discrete(name = "nursing_setup_at_12mo")+ xlab("chronic_disease") + ylab("percent of disease")# +scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'))
table(number_of_ABX_first_year, covid_time)
ftable(number_of_ABX_first_year, covid_time)
ftable(number_of_ABX_first_year, covid_time)
round(ftable(covid_time, number_of_ABX_first_year) / rowSums(ftable(covid_time, number_of_ABX_first_year)),3)
number_of_ABX_first_year
number_of_ABX_first_year !=0
number_of_ABX_first_year[number_of_ABX_first_year !=0]
number_of_ABX_first_year_non_zero <- number_of_ABX_first_year[number_of_ABX_first_year !=0]
round(ftable(covid_time, number_of_ABX_first_year_non_zero) / rowSums(ftable(covid_time, number_of_ABX_first_year_non_zero)),3)
number_of_ABX_first_year_non_zero <- number_of_ABX_first_year[number_of_ABX_first_year !=0]
round(ftable(covid_time, number_of_ABX_first_year_non_zero) / rowSums(ftable(covid_time, number_of_ABX_first_year_non_zero)),3)
round(ftable(covid_time, number_of_ABX_first_year) / rowSums(ftable(covid_time, number_of_ABX_first_year)),3)
ftable(covid_time, number_of_ABX_first_year)
ftable(covid_time, number_of_ABX_first_year)[-1]
ftable(covid_time, number_of_ABX_first_year)
number_of_ABX_first_year_non_zero <- number_of_ABX_first_year[number_of_ABX_first_year !=0]
covid_time_non_zero <- number_of_ABX_first_year[number_of_ABX_first_year !=0]
round(ftable(covid_time_non_zero, number_of_ABX_first_year_non_zero) / rowSums(ftable(covid_time_non_zero, number_of_ABX_first_year_non_zero)),3)
number_of_ABX_first_year_non_zero
covid_time_non_zero
covid_time_non_zero <- covid_time[number_of_ABX_first_year !=0]
covid_time_non_zero
number_of_ABX_first_year_non_zero <- number_of_ABX_first_year[number_of_ABX_first_year !=0]
covid_time_non_zero <- covid_time[number_of_ABX_first_year !=0]
round(ftable(covid_time_non_zero, number_of_ABX_first_year_non_zero) / rowSums(ftable(covid_time_non_zero, number_of_ABX_first_year_non_zero)),3)
# Check the number of treatments required by covid time group (from the ones that did nedded a treatment )
# we can see that in group3 were nedded more treatments!!
number_of_ABX_second_year_non_zero <- number_ABX_treatment_24_months[number_ABX_treatment_24_months !=0]
covid_time_non_zero <- covid_time[number_ABX_treatment_24_months !=0]
round(ftable(covid_time_non_zero, number_of_ABX_second_year_non_zero) / rowSums(ftable(covid_time_non_zero, number_of_ABX_second_year_non_zero)),3)
colnames(df)
df
colnames(df)
# Same as above for the second year !!
number_inhalation_no0 <- number_inhalation[number_inhalation !=0]
covid_time_non_zero <- covid_time[number_inhalation !=0]
round(ftable(covid_time_non_zero, number_inhalation_no0) / rowSums(ftable(covid_time_non_zero, number_inhalation_no0)),3)
treatments_kpi <- c(number_of_ABX_first_year, number_ABX_treatment_24_months×ª number_inhalation)
treatments_prop <- function(kpi){
kpi_no0 <- kpi[kpi !=0]
covid_time_no0 <- covid_time[kpi !=0]
return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
treatments_kpi <- c(number_of_ABX_first_year, number_ABX_treatment_24_months, number_inhalation)
treatments_prop <- function(kpi){
kpi_no0 <- kpi[kpi !=0]
covid_time_no0 <- covid_time[kpi !=0]
return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
sapply(treatments_kpi, treatments_prop)
sapply(treatments_kpi, treatments_prop)
treatments_kpi <- c(number_of_ABX_first_year, number_ABX_treatment_24_months, number_inhalation)
treatments_prop <- function(kpi){
kpi_no0 <- kpi[kpi !=0]
covid_time_no0 <- covid_time[kpi !=0]
return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
sapply(treatments_kpi, treatments_prop)
treatments_kpi <- c(number_of_ABX_first_year)
treatments_prop <- function(kpi){
kpi_no0 <- kpi[kpi !=0]
covid_time_no0 <- covid_time[kpi !=0]
return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
sapply(treatments_kpi, treatments_prop)
treatments_prop <- function(kpi){
data <- df %>% filter(covid_time, kpi)
data <- data[data[[kpi]] != 0 ]
# kpi_no0 <- kpi[kpi !=0]
# covid_time_no0 <- covid_time[kpi !=0]
# return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
return(round(ftable(data[covid_time], data[[kpi]]) / rowSums(ftable(data[covid_time], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop)
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi)
data <- data[data[[kpi]] != 0 ]
# kpi_no0 <- kpi[kpi !=0]
# covid_time_no0 <- covid_time[kpi !=0]
# return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
return(round(ftable(data[covid_time], data[[kpi]]) / rowSums(ftable(data[covid_time], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop)
lapply(treatments_kpi, treatments_prop)
data <- df %>% select(covid_time, kpi)
data
data <- df %>% select(covid_time, number_of_ABX_first_year)
data
data <- df %>% select(covid_time, 'number_of_ABX_first_year')
data
data <- df %>% select(covid_time, 'number_of_ABX_first_year') %>% filter('number_of_ABX_first_year' > 0)
data
data <- df %>% select(covid_time, 'number_of_ABX_first_year') %>% filter(df[['number_of_ABX_first_year']] > 0)
data
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
# kpi_no0 <- kpi[kpi !=0]
# covid_time_no0 <- covid_time[kpi !=0]
# return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
return(round(ftable(data[covid_time], data[[kpi]]) / rowSums(ftable(data[covid_time], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop)
data[covid_time]
data['covid_time']
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
# kpi_no0 <- kpi[kpi !=0]
# covid_time_no0 <- covid_time[kpi !=0]
# return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
return(round(ftable(data['covid_time'], data[[kpi]]) / rowSums(ftable(data['covid_time'], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop)
round(ftable(data['covid_time'], data[[kpi]]) / rowSums(ftable(data['covid_time'], data[[kpi]])),3)
data <- df %>% select(covid_time, 'number_of_ABX_first_year') %>% filter(df[['number_of_ABX_first_year']] > 0)
sapply(treatments_kpi, treatments_prop)
kpi =
treatments_kpi <- c('number_of_ABX_first_year')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
# kpi_no0 <- kpi[kpi !=0]
# covid_time_no0 <- covid_time[kpi !=0]
# return(round(ftable(covid_time_no0, kpi_no0) / rowSums(ftable(covid_time_no0, kpi_no0)),3))}
return(round(ftable(data['covid_time'], data[[kpi]]) / rowSums(ftable(data['covid_time'], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop)
number_of_ABX_first_year
lapply(treatments_kpi, treatments_prop)
treatments_kpi <- c('number_of_ABX_first_year')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data['covid_time'], data[[kpi]]) / rowSums(ftable(data['covid_time'], data[[kpi]])),3))}
lapply(treatments_kpi, treatments_prop)
data <- df %>% select(covid_time, 'number_of_ABX_first_year') %>% filter(df[['number_of_ABX_first_year']] > 0)
number_of_ABX_first_year
lapply(treatments_kpi, treatments_prop)
kpi = 'number_of_ABX_first_year'
ftable(data['covid_time'], data[[kpi]])
data[[kpi]]
data['covid_time']
treatments_kpi <- c('number_of_ABX_first_year')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data['covid_time'], data[kpi]) / rowSums(ftable(data['covid_time'], data[kpi])),3))}
lapply(treatments_kpi, treatments_prop)
kpi = 'number_of_ABX_first_year'
treatments_kpi <- c('number_of_ABX_first_year')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data['covid_time'], data[kpi]) / rowSums(ftable(data['covid_time'], data[kpi])),3))}
lapply(treatments_kpi, treatments_prop)
data[kpi]
data['covid_time']
data[['covid_time']]
kpi = 'number_of_ABX_first_year'
treatments_kpi <- c('number_of_ABX_first_year')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
lapply(treatments_kpi, treatments_prop)
sapply(treatments_kpi, treatments_prop)
sapply(treatments_kpi, treatments_prop, simplify = FALSE)
colnames(df)
colnames(df)
#
treatments_kpi <- c('number_of_ABX_first_year', 'number_ABX_treatment_24_months', 'number_inhalation')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop, simplify = FALSE)
# how many treatment was given in different covid time groups
treatments_kpi <- c('number_of_ABX_first_year', 'number_ABX_treatment_24_months', 'number_inhalation')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop, simplify = FALSE)
colnames(df)
colnames(df)
# how many treatment was given in different covid time groups
treatments_kpi <- c('number_of_ABX_first_year', 'number_ABX_treatment_24_months', 'number_inhalation',
'hospitalization_24_months', 'number_steroid_treat', )
treatments_kpi <- c('number_of_ABX_first_year', 'number_ABX_treatment_24_months', 'number_inhalation',
'hospitalization_24_months', 'number_steroid_treat')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop, simplify = FALSE)
hospitalization_24_months
treatments_kpi <- c('number_of_ABX_first_year', 'number_ABX_treatment_24_months', 'number_inhalation','number_steroid_treat')
treatments_prop <- function(kpi){
data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
sapply(treatments_kpi, treatments_prop, simplify = FALSE)
plot_df_10 <- df %>% select(nursing_setup_at_12mo,is_atopic_first_year,is_atopic_second_year,AD_first_year, AD_24_month, FA_first_year,food_allergy_24_month, ABX_fisrt_year,inhalation_24_month) %>% drop_na() %>% group_by(nursing_setup_at_12mo) %>% summarise(is_atopic_first_year= mean(is_atopic_first_year), is_atopic_second_year= mean(is_atopic_second_year),AD_first_year = mean(AD_first_year), AD_24_month = mean(AD_24_month), FA_first_year = mean(FA_first_year),food_allergy_24_month = mean(food_allergy_24_month), ABX_fisrt_year = mean(ABX_fisrt_year),inhalation_24_month = mean(inhalation_24_month)) %>% gather(chronic_disease, mean, is_atopic_first_year:inhalation_24_month, factor_key=TRUE)
ggplot(plot_df_10,aes(x=as.factor(chronic_disease), y= mean, fill = as.factor(nursing_setup_at_12mo))) +
geom_col(position = "dodge") + scale_fill_discrete(name = "nursing_setup_at_12mo")+ xlab("chronic_disease") + ylab("percent of disease")# +scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'))
kpi = 'nursing_setup_at_12mo'
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>% filter(data[[kpi]] >0) %>%
group_by(kpi) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>% filter(df[[kpi]] >0) %>%
group_by(kpi) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>%
group_by(kpi) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
df
colnames(filter(data[[kpi]] >0))
colnames(df)
kpi = 'nursing_setup_at_12mo'
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>%
group_by(kpi) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(exploreatory_variables, kpi))
data
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>%
group_by(kpi)
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>%
group_by(nursing_setup_at_12mo) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>%
group_by('nursing_setup_at_12mo') %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(exploreatory_variables, kpi)) %>% drop_na() %>%
group_by(kpi) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables)) %>% drop_na() %>%
group_by(kpi) %>%
summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables))
data
data <- df %>% select(c(kpi,exploreatory_variables)) %>% drop_na() %>%
group_by(1)
data
data <- df %>% select(c(kpi,exploreatory_variables)) %>% drop_na() %>%
group_by(1) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data
data <- df %>% select(c(kpi,exploreatory_variables)) %>% filter(data[[kpi]] >0) %>% drop_na() %>%
group_by(1) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables)) %>% drop_na() %>%
group_by(1) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- data %>% filter(data[kpi] > 0)
data <- df %>% select(c(kpi,exploreatory_variables))%>% filter(data[kpi] > 0) %>% drop_na() %>%
group_by(1) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables))%>% filter( df[kpi] > 0) %>% drop_na() %>%
group_by(1) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data
ggplot(data, aes(kpi, count, fill = as.factor(kpi))) + geom_col() + theme_bw() +facet_wrap(~chronic_disease,4,2)
data
plot_df_10 <- df %>% select(nursing_setup_at_12mo,is_atopic_first_year,is_atopic_second_year,AD_first_year, AD_24_month, FA_first_year,food_allergy_24_month, ABX_fisrt_year,inhalation_24_month) %>% drop_na() %>% group_by(nursing_setup_at_12mo) %>% summarise(is_atopic_first_year= mean(is_atopic_first_year), is_atopic_second_year= mean(is_atopic_second_year),AD_first_year = mean(AD_first_year), AD_24_month = mean(AD_24_month), FA_first_year = mean(FA_first_year),food_allergy_24_month = mean(food_allergy_24_month), ABX_fisrt_year = mean(ABX_fisrt_year),inhalation_24_month = mean(inhalation_24_month)) %>% gather(chronic_disease, mean, is_atopic_first_year:inhalation_24_month, factor_key=TRUE)
plot_df_10
data <- df %>% select(c(kpi,exploreatory_variables))%>% filter( df[kpi] > 0) %>% drop_na() %>%
group_by(kpi) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables))%>% filter( df[kpi] > 0) %>% drop_na() %>%
group_by(data[kpi]) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data[kpi]
kpi = 'nursing_setup_at_12mo'
data <- df %>% select(c(kpi,exploreatory_variables))%>% filter( df[kpi] > 0) %>% drop_na() %>%
group_by(data[kpi]) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data
df
df %>% select(c(kpi,exploreatory_variables))%>% filter( df[kpi] > 0)
df %>% select(c(kpi,exploreatory_variables))
data[kpi]
data <- df %>% select(c(kpi,exploreatory_variables)) %>% filter( df[kpi] > 0) %>% drop_na() %>%
group_by(df[kpi]) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables))  %>% drop_na() %>%
group_by(df[kpi]) %>% filter( df[kpi] > 0) %>% summarise_if(is.numeric, sum) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables))  %>% drop_na() %>%
group_by(df[kpi]) %>% summarise_if(is.numeric, sum) %>% filter( df[kpi] > 0) %>%
pivot_longer(cols  =exploreatory_variables, names_to = "chronic_disease", values_to = "count")
data <- df %>% select(c(kpi,exploreatory_variables))  %>% drop_na() %>%
group_by(df[kpi]) %>% summarise_if(is.numeric, sum) #%>% filter( df[kpi] > 0) %>%
kpi
data <- df %>% select(c(kpi,exploreatory_variables))  %>% drop_na() %>%
group_by(kpi) %>% summarise_if(is.numeric, sum) #%>% filter( df[kpi] > 0) %>%
