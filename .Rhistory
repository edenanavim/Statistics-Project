df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
#Creating dependent variables:
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#option B of explanatory var:
#From mail
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
# table(df$covid_time)
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_cont = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# at this moment there is no sutible data from group 4 - post corona
# attach(df)
# df change to factors
# df$SES <- as.factor(df$SES)
# df$`Jew/Arab` <- as.factor(df$`Jew/Arab`)
# df$gender <- as.factor(df$gender)
# df$study_group_COMEET <- as.factor(df$study_group_COMEET)
# df$mother_education <- as.factor(df$mother_education)
# df$number_of_children <- as.factor(df$number_of_children)
# df$preganancy_number <- as.factor(df$preganancy_number)
# df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
# df$family_Atopic_diseases <- as.factor(df$family_Atopic_diseases)
# df$sibling_Atopic_diseases <- as.factor(df$sibling_Atopic_diseases)
# df$mother_Atopic_diseases <- as.factor(df$mother_Atopic_diseases)
# df$father_Atopic_diseases <- as.factor(df$father_Atopic_diseases)
# df$SES <- as.factor(df$SES)
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
library(mgcv)
options(scipen=5, digits = 5)
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# Filtering only participants that completed the second year:
df <- df %>% filter(month_survey_complete == 2)
# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
#remove_columns = colnames(df)[51:88]
df <- df[,-c(51:88)]
# Removing columns with allot on NA:
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)]
# Adding binary columns
# A. Did any one from family (mother, father, sib) have *any* of the disease?
df$family_Atopic_diseases_sum <- rowSums(df[,14:37])
# B. Did somebody from family have a specific disease?
# NEED TO FILL IN
# C. Did a disease appear in a specific family member?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17])
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# Sibilings
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
#Creating dependent variables:
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#option B of explanatory var:
#From mail
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
# table(df$covid_time)
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_cont = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# at this moment there is no sutible data from group 4 - post corona
# attach(df)
# df change to factors
# df$SES <- as.factor(df$SES)
# df$`Jew/Arab` <- as.factor(df$`Jew/Arab`)
# df$gender <- as.factor(df$gender)
# df$study_group_COMEET <- as.factor(df$study_group_COMEET)
# df$mother_education <- as.factor(df$mother_education)
# df$number_of_children <- as.factor(df$number_of_children)
# df$preganancy_number <- as.factor(df$preganancy_number)
# df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
# df$family_Atopic_diseases <- as.factor(df$family_Atopic_diseases)
# df$sibling_Atopic_diseases <- as.factor(df$sibling_Atopic_diseases)
# df$mother_Atopic_diseases <- as.factor(df$mother_Atopic_diseases)
# df$father_Atopic_diseases <- as.factor(df$father_Atopic_diseases)
# df$SES <- as.factor(df$SES)
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
library(mgcv)
options(scipen=5, digits = 5)
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# Filtering only participants that completed the second year:
df <- df %>% filter(month_survey_complete == 2)
# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
#remove_columns = colnames(df)[51:88]
df <- df[,-c(51:88)]
# Removing columns with allot on NA:
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)]
# Adding binary columns
# A. Did any one from family (mother, father, sib) have *any* of the disease?
df$family_Atopic_diseases_sum <- rowSums(df[,14:37])
# B. Did somebody from family have a specific disease?
# NEED TO FILL IN
# C. Did a disease appear in a specific family member?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17])
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# Sibilings
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
#Creating dependent variables:
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#option B of explanatory var:
#From mail
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
# table(df$covid_time)
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_cont = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# at this moment there is no sutible data from group 4 - post corona
# attach(df)
# df change to factors
# df$SES <- as.factor(df$SES)
# df$`Jew/Arab` <- as.factor(df$`Jew/Arab`)
# df$gender <- as.factor(df$gender)
# df$study_group_COMEET <- as.factor(df$study_group_COMEET)
# df$mother_education <- as.factor(df$mother_education)
# df$number_of_children <- as.factor(df$number_of_children)
# df$preganancy_number <- as.factor(df$preganancy_number)
# df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
# df$family_Atopic_diseases <- as.factor(df$family_Atopic_diseases)
# df$sibling_Atopic_diseases <- as.factor(df$sibling_Atopic_diseases)
# df$mother_Atopic_diseases <- as.factor(df$mother_Atopic_diseases)
# df$father_Atopic_diseases <- as.factor(df$father_Atopic_diseases)
# df$SES <- as.factor(df$SES)
df
n_obs = length(df)
n_obs
n_obs = length(df$record_id)
n_obs
n_atopic1 = sum(df$is_atopic_first_year)
n_atopic2 = sum(df$is_atopic_second_year)
n_atopic1
n_atopic2 = sum(df$is_atopic_second_year)
n_atopic2
n_atopic2 = sum(df$is_atopic_second_year, na.rm = T)
n_atopic2
n_atopic1
table(df$covid_time)
groups_freq = table(df$covid_time)
groups_freq
# at this moment there is no sutible data from group 4 - post corona
attach(df)
unique(SES)
sort(unique(SES))
# create a categoric SES variable :
df <- df %>% mutate(SES_group = ifelse(SES>8, '9-10', ifelse(SES>5, '6-8', ifelse(SES>2, '3-5', '1-2'))))
df
# at this moment there is no sutible data from group 4 - post corona
attach(df)
table(SES_group)
tablelist <- mapply(table, df %>% select(-c(record_id, DOB, mother_year_birth)))
tablelist
covid_time_prop <- round(tablelist[['covid_time']] / sum(tablelist[['covid_time']]),2)
covid_time_prop
tablelist
covid_time_prop
covid_time_table <- function(kpi){
return(list(perc = round(ftable(covid_time, df[[kpi]]) / rowSums(ftable(covid_time, df[[kpi]])),3),
n = table(covid_time, df[[kpi]])))}
sapply(binari_exp, covid_time_table, simplify =FALSE)
# MASBIR
full_binari_exp <- c('Jew/Arab', 'gender', 'Allergy_total',
'mother_asthma', 'mother_atopic_dermatitis', 'mother_Allergic_rhinitis', 'mother_food_allergy',
'father_asthma', 'father_atopic_dermatitis', 'father_Allergic_rhinitis', 'father_food_allergy',
'sibling1_asthma', 'sibling1_atopic_dermatitis', 'sibling1_Allergic_rhinitis', 'sibling1_food_allergy',
'sibling2_asthma', 'sibling2_atopic_dermatitis', 'sibling2_Allergic_rhinitis', 'sibling2_food_allergy',
'sibling3_asthma', 'sibling3_atopic_dermatitis', 'sibling3_Allergic_rhinitis', 'sibling3_food_allergy',
'sibling4_asthma', 'sibling4_atopic_dermatitis', 'sibling4_Allergic_rhinitis', 'sibling4_food_allergy',
'vaccine_12mo', 'prevention_therapy', 'steroids_treatment24',
'hospitalization_24_months', 'chronic_disease_24',
'family_Atopic_diseases', 'mother_Atopic_diseases', 'father_Atopic_diseases', 'sibling_Atopic_diseases')
# MASBIR
full_binari_exp <- c('Jew/Arab', 'gender', 'Allergy_total',
'mother_asthma', 'mother_atopic_dermatitis', 'mother_Allergic_rhinitis', 'mother_food_allergy',
'father_asthma', 'father_atopic_dermatitis', 'father_Allergic_rhinitis', 'father_food_allergy',
'sibling1_asthma', 'sibling1_atopic_dermatitis', 'sibling1_Allergic_rhinitis', 'sibling1_food_allergy',
'sibling2_asthma', 'sibling2_atopic_dermatitis', 'sibling2_Allergic_rhinitis', 'sibling2_food_allergy',
'sibling3_asthma', 'sibling3_atopic_dermatitis', 'sibling3_Allergic_rhinitis', 'sibling3_food_allergy',
'sibling4_asthma', 'sibling4_atopic_dermatitis', 'sibling4_Allergic_rhinitis', 'sibling4_food_allergy',
'vaccine_12mo', 'prevention_therapy', 'steroids_treatment24',
'hospitalization_24_months', 'chronic_disease_24',
'family_Atopic_diseases', 'mother_Atopic_diseases', 'father_Atopic_diseases', 'sibling_Atopic_diseases')
binari_exp <- c('Jew/Arab', 'gender', 'Allergy_total','vaccine_12mo', 'prevention_therapy',
'family_Atopic_diseases', 'mother_Atopic_diseases', 'father_Atopic_diseases', 'sibling_Atopic_diseases')
continues_exp <- c('mother_year_birth', 'DOB', 'mother_education')
discrite_exp <- c('SES', 'number_of_children', 'preganancy_number', 'number_of_ABX_first_year', 'number_inhalation',
'family_Atopic_diseases_sum', 'mother_Atopic_diseases_sum', 'father_Atopic_diseases_sum', 'sibling_Atopic_diseases_sum',
'sibling_asthma_sum', 'sibling_AD_sum', 'sibling_Allergic_rhinitis_sum', 'sibling_FA_sum')
categoric_exp <- c('type_of_pregnancy', 'nursing_setup_at_12mo', 'covid_time')
#MOOSBAR
exploreatory_variables <- c('HRAD_first_year', 'AD_first_year', 'FA_first_year', 'ABX_fisrt_year',
'HRAD_second_year', 'AD_second_year', 'FA_second_year', 'ABX_second_year',
'is_atopic_first_year', 'is_atopic_second_year')
covid_time_table <- function(kpi){
return(list(perc = round(ftable(covid_time, df[[kpi]]) / rowSums(ftable(covid_time, df[[kpi]])),3),
n = table(covid_time, df[[kpi]])))}
sapply(binari_exp, covid_time_table, simplify =FALSE)
colnames(df)
df$feeding_type <- df$study_group_COMEET
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_22.2.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# Filtering only participants that completed the second year:
df <- df %>% filter(month_survey_complete == 2)
# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
#remove_columns = colnames(df)[51:88]
df <- df[,-c(51:88)]
# Removing columns with allot on NA:
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)]
# Adding binary columns
# A. Did any one from family (mother, father, sib) have *any* of the disease?
df$family_Atopic_diseases_sum <- rowSums(df[,14:37])
# B. Did somebody from family have a specific disease?
# NEED TO FILL IN
# C. Did a disease appear in a specific family member?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17])
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# Sibilings
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
#Creating dependent variables:
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
df$feeding_type <- df$study_group_COMEET
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
df$DOB_cont = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
# create a categoric SES variable :
df <- df %>% mutate(SES_group = ifelse(SES>8, '9-10', ifelse(SES>5, '6-8', ifelse(SES>2, '3-5', '1-2'))))
# at this moment there is no sutible data from group 4 - post corona
attach(df)
n_obs = length(record_id)
n_obs
# The input needs to be checked after talking to Idit
mdl1 <- glm(is_atopic_first_year~ SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases + # + sibling_Atopic_diseases
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy + DOB  , data = df, family = "binomial")
summary(mdl1)
# The input needs to be checked after talking to Idit
mdl1 <- glm(is_atopic_first_year~ SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases + # + sibling_Atopic_diseases
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy + DOB_cont  , data = df, family = "binomial")
summary(mdl1)
# The input needs to be checked after talking to Idit
mdl1 <- glm(is_atopic_first_year~ SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases + # + sibling_Atopic_diseases
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy + DOB  , data = df, family = "binomial")
summary(mdl1)
mdl2 <- glm(is_atopic_second_year ~ SES + gender + vaccine_12mo + feeding_type +
mother_Atopic_diseases + father_Atopic_diseases + sibling_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy + nursing_setup_at_12mo + is_atopic_first_year + DOB, data = df, family = "binomial")
summary(mdl2)
# The input needs to be checked after talking to Idit
mdl1 <- glm(is_atopic_first_year~ SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases + # + sibling_Atopic_diseases
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy + DOB  , data = df, family = "binomial")
summary(mdl1)
tablelist <- mapply(table, c(SES_group, gender))
tablelist
tablelist <- mapply(table, df %>% select(c(gender)))
tablelist
tablelist <- mapply(table, df %>% select(c(SES_group,gender,mother_Atopic_diseases,father_Atopic_diseases,#,sibling_Atopic_diseases
mother_year_birth,mother_education,number_of_children,type_of_pregnancy)))
tablelist
tablelist <- mapply(table, df %>% select(c(SES_group, gender, mother_Atopic_diseases, father_Atopic_diseases, #,sibling_Atopic_diseases
mother_education, number_of_children, type_of_pregnancy)))
tablelist
tablelist1 <- mapply(table, df %>% select(c(SES_group, gender, mother_Atopic_diseases, father_Atopic_diseases, sibling_Atopic_diseases,
mother_education, number_of_children, type_of_pregnancy)))
tablelist2 <- mapply(table, df %>% select(c(SES, gender, vaccine_12mo, feeding_type, mother_Atopic_diseases, father_Atopic_diseases, sibling_Atopic_diseases,
mother_education, number_of_children, type_of_pregnancy, nursing_setup_at_12mo)))
tablelist2
covid_time_prop
covid_time_prop <- round(tablelist[['covid_time']] / sum(tablelist[['covid_time']]),2)
covid_time_prop
covid_time_prop <- round(tablelist[['covid_time']] / sum(tablelist[['covid_time']]),2)
covid_time_prop <- round(tablelist1[['covid_time']] / sum(tablelist1[['covid_time']]),2)
covid_time_prop
tablelist1 <- mapply(table, df %>% select(c(SES_group, gender, mother_Atopic_diseases, father_Atopic_diseases, sibling_Atopic_diseases,
mother_education, number_of_children, type_of_pregnancy, covid_time)))
covid_time_prop <- round(tablelist1[['covid_time']] / sum(tablelist1[['covid_time']]),2)
covid_time_prop
colnames(df)
number_of_children
exp_var1 <- c(SES_group, gender, mother_Atopic_diseases, father_Atopic_diseases, sibling_Atopic_diseases,
mother_education, number_of_children, type_of_pregnancy, covid_time)
exp_var2 <- c(SES, gender, vaccine_12mo, feeding_type, mother_Atopic_diseases, father_Atopic_diseases, sibling_Atopic_diseases,
mother_education, number_of_children, type_of_pregnancy, nursing_setup_at_12mo)
tablelist1 <- mapply(table, df %>% select(exp_var1))
tablelist1 <- mapply(table, df %>% select(as.character(exp_var1)))
tablelist1 <- mapply(table, df %>% select(exp_var1))
tablelist1
tablelist1 <- mapply(table, df %>% select(exp_var1))
exp_var1
exp_var1 <- df %>% select(c(SES_group, gender, mother_Atopic_diseases, father_Atopic_diseases, sibling_Atopic_diseases,
mother_education, number_of_children, type_of_pregnancy, covid_time))
exp_var2 <- df %>% select(c(SES, gender, vaccine_12mo, feeding_type, mother_Atopic_diseases, father_Atopic_diseases, sibling_Atopic_diseases,
mother_education, number_of_children, type_of_pregnancy, nursing_setup_at_12mo))
tablelist1 <- mapply(table, exp_var1)
tablelist2 <- mapply(table, exp_var2)
tablelist1
exp_var1
boxplot(is_atopic_first_year, number_of_children)
boxplot(number_of_children, is_atopic_first_year)
number_of_children
