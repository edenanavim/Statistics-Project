labs( title = 'covid time VS steroid_treat', x = 'covid time group', y = 'count', fill = 'number of antib...')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_steroid_treat >0 )%>% group_by(covid_time) %>% summarise(avg_steroid_treat = mean(number_steroid_treat))
# how many treatment was given in different covid time groups
treatments_kpi <- c('number_of_ABX_first_year', 'number_inhalation','number_steroid_treat')
# proportion tables
# treatments_prop <- function(kpi){
#   data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
#   return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
# sapply(treatments_kpi, treatments_prop, simplify = FALSE)
ggplot(df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_of_ABX_first_year', x = 'covid time group', y = 'prop', fill = 'number of antibiotics treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
ggplot(df %>% filter(number_inhalation >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_inhalation))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_inhalation', x = 'covid time group', y = 'prop', fill = 'number of inhalation treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_inhalation >0 )%>% group_by(covid_time) %>% summarise(avg_number_inhalation = mean(number_inhalation))
ggplot(df %>% filter(number_steroid_treat >0 ) %>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_steroid_treat))) + geom_bar(position = "fill") +
labs( title = 'covid time VS steroid_treat', x = 'covid time group', y = 'prop', fill = 'number of steroid treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_steroid_treat >0 )%>% group_by(covid_time) %>% summarise(avg_steroid_treat = mean(number_steroid_treat))
# how many treatment was given in different covid time groups
treatments_kpi <- c('number_of_ABX_first_year', 'number_inhalation','number_steroid_treat')
# proportion tables
# treatments_prop <- function(kpi){
#   data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
#   return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
# sapply(treatments_kpi, treatments_prop, simplify = FALSE)
ggplot(df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
ggplot(df %>% filter(number_inhalation >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_inhalation))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_inhalation', x = '', y = 'prop', fill = 'number of inhalation treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_inhalation >0 )%>% group_by(covid_time) %>% summarise(avg_number_inhalation = mean(number_inhalation))
ggplot(df %>% filter(number_steroid_treat >0 ) %>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_steroid_treat))) + geom_bar(position = "fill") +
labs( title = 'covid time VS steroid_treat', x = '', y = 'prop', fill = 'number of steroid treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_steroid_treat >0 )%>% group_by(covid_time) %>% summarise(avg_steroid_treat = mean(number_steroid_treat))
ggplot(df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill", stat = "identity") +
labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
ggplot(df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") +  geom_text(position = 'fill') +
labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") +
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") +
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") +
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill")
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(mutate(label = gsub('^[0](\\.\\d{1,2}).*', '\\1', amount / sum(amount))))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(mutate(label = gsub('^[0](\\.\\d{1,2}).*', '\\1', covid_time / sum(covid_time))))
covid_time
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
ggplot(df %>% filter(number_inhalation >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_inhalation))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_inhalation', x = '', y = 'prop', fill = 'number of inhalation treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_inhalation >0 )%>% group_by(covid_time) %>% summarise(avg_number_inhalation = mean(number_inhalation))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + +geom_text(aes(label=scales::percent(..count../..count..,group = cs)), stat='count',position=position_stack(0.5))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(aes(label=scales::percent(..count../..count..,group = cs)), stat='count',position=position_stack(0.5))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(aes(label=scales::percent(..count../..count..,group = cs)), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(aes(label=scales::percent(..count../..count..,group = cs)))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(aes(label=scales::percent(..count../..count..,group = cs)), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(aes(label=scales::percent(..count../..count..,group = covid_time)), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() +    geom_text(aes(label=scales::percent(..count../sum(..count..))), stat='covid_time',position=position_stack(0.5))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() +    geom_text(aes(label=scales::percent(..count../sum(..count..))))
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(aes(label=scales::percent(..count../sum(..count..),group = covid_time)), stat='count')
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() + geom_text(aes(label=scales::(..count../sum(..count..),group = covid_time), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() +
geom_text(aes(label=scales::percent(..count../sum(..count..),group = covid_time)), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() +
geom_text(aes(label=scales::(..count../sum(..count..),group = covid_time)), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() +
geom_text(aes(label=scales::percent(..count../sum(..count..),group = covid_time)), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw() +
geom_text(aes(label=scales::percent(..count../sum(..count..) / 100,group = covid_time)), stat='count')
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) + geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3, text = element_text(size = 20)) + theme_bw() +scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white')) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) + geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3, text = element_text(size = 30)) + theme_bw() +scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white')) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3) + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white'), text = element_text(size = 30)) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3) + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white'), text = element_text(size = 10)) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3) + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white'), text = element_text(size = 15)) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 8) + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white')) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 4) + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white')) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 4, face = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white')) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 4, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white')) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white')) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + theme(axis.text.x = element_text( color = 'white'), text = element_text(size =12)) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + ylab('prop') + theme(axis.text.x = element_text( color = 'white'), text = element_text(size =12)) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + ylab('prop') + theme(axis.text.x = element_text( color = 'white'), text = element_text(size =12, fontface = "bold")) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + ylab('prop') + theme(axis.text.x = element_text( color = 'white'), text = element_text(size =12)) + ylim(c(0,0.7))
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + ylab('prop') + theme(axis.text.x = element_text( color = 'white'), text = element_text(size =12), strip.text = element_text(face = "bold")) + ylim(c(0,0.7))
is_atopic = c('is_atopic_first_year', 'is_atopic_second_year')
is_atopic_longer <- df %>% select(c(is_atopic, covid_time,Born_at)) %>% drop_na() %>% group_by(covid_time, Born_at) %>% summarise_if(is.numeric, mean) %>% pivot_longer(cols = is_atopic, names_to = "chronic_disease", values_to = "mean")
ggplot(is_atopic_longer, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + theme_bw() + facet_wrap(~chronic_disease) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("")+  ylab("proportion") + theme(axis.text.x = element_text(color = 'white')) +
geom_text(aes(label = round(is_atopic_longer$mean,3)), vjust = 0, size = 3)
ggplot(is_atopic_longer, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + theme_bw() + facet_wrap(~chronic_disease) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("")+  ylab("proportion") + theme(axis.text.x = element_text(color = 'white')) +
geom_text(aes(label = round(is_atopic_longer$mean,3)), vjust = 0, size = 3, text = element_text(size =12), strip.text = element_text(face = "bold"))
ggplot(is_atopic_longer, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + theme_bw() + facet_wrap(~chronic_disease) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("")+  ylab("proportion") + theme(axis.text.x = element_text(color = 'white'),  text = element_text(size =12), strip.text = element_text(face = "bold")) +
geom_text(aes(label = round(is_atopic_longer$mean,3)), vjust = 0, size = 3.5)
ggplot(is_atopic_longer, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + theme_bw() + facet_wrap(~chronic_disease) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("")+  ylab("proportion") + theme(axis.text.x = element_text(color = 'white'),  text = element_text(size =12), strip.text = element_text(face = "bold")) +
geom_text(aes(label = round(is_atopic_longer$mean,3)), vjust = 0, size = 3.5, fontface = "bold")
ggplot(new_df_longer, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + theme_bw() +
facet_wrap(~chronic_disease) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + ylab("proportion") + theme(axis.text.x = element_text(color = 'white'), text = element_text(size =12), strip.text = element_text(face = "bold")) +
geom_text(aes(label = round(new_df_longer$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + ylim(c(0, 0.25))
# how many treatment was given in different covid time groups
treatments_kpi <- c('number_of_ABX_first_year', 'number_inhalation','number_steroid_treat')
# proportion tables
# treatments_prop <- function(kpi){
#   data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
#   return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
# sapply(treatments_kpi, treatments_prop, simplify = FALSE)
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time, Born_at) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
ggplot(df %>% filter(number_inhalation >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_inhalation))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_inhalation', x = '', y = 'prop', fill = 'number of inhalation treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_inhalation >0 )%>% group_by(covid_time) %>% summarise(avg_number_inhalation = mean(number_inhalation))
ggplot(df %>% filter(number_steroid_treat >0 ) %>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_steroid_treat))) + geom_bar(position = "fill") +
labs( title = 'covid time VS steroid_treat', x = '', y = 'prop', fill = 'number of steroid treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_steroid_treat >0 )%>% group_by(covid_time) %>% summarise(avg_steroid_treat = mean(number_steroid_treat))
df %>% filter(number_steroid_treat >0 )%>% group_by(covid_time) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), avg_number_inhalation = mean(number_inhalation), avg_steroid_treat = mean(number_steroid_treat), .groups = 'drop')
no_is_atopic = c('HRAD_first_year', 'AD_first_year', 'FA_first_year',
'HRAD_second_year', 'AD_second_year', 'FA_second_year')
atopic_longer_count <- df %>% select(c(no_is_atopic, covid_time,Born_at)) %>% drop_na() %>% group_by(covid_time, Born_at) %>% summarise_if(is.numeric, mean) %>% pivot_longer(cols  =no_is_atopic, names_to = "chronic_disease", values_to = "mean")
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + ylab('prop') + theme(axis.text.x = element_text( color = 'white'), text = element_text(size =12), strip.text = element_text(face = "bold")) + ylim(c(0,0.7))
#SES
p = as.data.frame(with(df,table(covid_time,SES))/rowSums(with(df,table(covid_time,SES))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(SES))) +
geom_col() + scale_fill_discrete(name = "SES")+ xlab("covid_time") + ylab("percentage")
#number_of_children
p = as.data.frame(with(df,table(covid_time,number_of_children))/rowSums(with(df,table(covid_time,number_of_children))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(number_of_children))) +
geom_col() + scale_fill_discrete(name = "number_of_children")+ xlab("covid_time") + ylab("percentage")
#preganancy_number
p = as.data.frame(with(df,table(covid_time,preganancy_number))/rowSums(with(df,table(covid_time,preganancy_number))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(preganancy_number))) +
geom_col() + scale_fill_discrete(name = "preganancy_number")+ xlab("covid_time") + ylab("percentage")
#type_of_pregnancy
p = as.data.frame(with(df,table(covid_time,type_of_pregnancy))/rowSums(with(df,table(covid_time,type_of_pregnancy))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(type_of_pregnancy))) +
geom_col() + scale_fill_discrete(name = "type_of_pregnancy")+ xlab("covid_time") + ylab("percentage")
#nursing_setup_at_12mo
p = as.data.frame(with(df,table(covid_time,nursing_setup_at_12mo))/rowSums(with(df,table(covid_time,nursing_setup_at_12mo))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ xlab("covid_time") + ylab("percentage")
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
# how many treatment was given in different covid time groups
treatments_kpi <- c('number_of_ABX_first_year', 'number_inhalation','number_steroid_treat')
# proportion tables
# treatments_prop <- function(kpi){
#   data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
#   return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
# sapply(treatments_kpi, treatments_prop, simplify = FALSE)
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
ggplot(df %>% filter(number_inhalation >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_inhalation))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_inhalation', x = '', y = 'prop', fill = 'number of inhalation treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_inhalation >0 )%>% group_by(covid_time) %>% summarise(avg_number_inhalation = mean(number_inhalation), .groups = 'drop')
ggplot(df %>% filter(number_steroid_treat >0 ) %>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_steroid_treat))) + geom_bar(position = "fill") +
labs( title = 'covid time VS steroid_treat', x = '', y = 'prop', fill = 'number of steroid treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
df %>% filter(number_steroid_treat >0 )%>% group_by(covid_time) %>% summarise(avg_steroid_treat = mean(number_steroid_treat), .groups = 'drop')
# how many treatment was given in different covid time groups
treatments_kpi <- c('number_of_ABX_first_year', 'number_inhalation','number_steroid_treat')
# proportion tables
# treatments_prop <- function(kpi){
#   data <- df %>% select(covid_time, kpi) %>% filter(df[[kpi]] > 0)
#   return(round(ftable(data[['covid_time']], data[[kpi]]) / rowSums(ftable(data[['covid_time']], data[[kpi]])),3))}
# sapply(treatments_kpi, treatments_prop, simplify = FALSE)
df %>% filter(number_of_ABX_first_year >0 )%>% mutate(covid_time = as.factor(covid_time)) %>% ggplot(aes(x=covid_time, fill=as.factor(number_of_ABX_first_year))) + geom_bar(position = "fill") + labs( title = 'covid time VS number_of_ABX_first_year', x = '', y = 'prop', fill = 'number of antibiotics treatments') +
scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
avg1 <- df %>% filter(number_of_ABX_first_year >0 )%>% group_by(covid_time) %>% summarise(avg_of_ABX_first_year = mean(number_of_ABX_first_year), .groups = 'drop')
ggplot(df %>% filter(number_inhalation >0 )%>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_inhalation))) + geom_bar(position = "fill") +
labs( title = 'covid time VS number_inhalation', x = '', y = 'prop', fill = 'number of inhalation treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
avg2 <- df %>% filter(number_inhalation >0 )%>% group_by(covid_time) %>% summarise(avg_number_inhalation = mean(number_inhalation), .groups = 'drop')
ggplot(df %>% filter(number_steroid_treat >0 ) %>% mutate(covid_time = as.factor(covid_time)), aes(x=covid_time, fill=as.factor(number_steroid_treat))) + geom_bar(position = "fill") +
labs( title = 'covid time VS steroid_treat', x = '', y = 'prop', fill = 'number of steroid treatments')+ scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
avg3 <- df %>% filter(number_steroid_treat >0 )%>% group_by(covid_time) %>% summarise(avg_steroid_treat = mean(number_steroid_treat), .groups = 'drop')
all_avg <- left_join(avg1, avg2)
all_avg <- left_join(all_avg, avg3)
all_avg
ggplot(df, aes(mother_year_birth, fill = as.factor(covid_time))) + geom_density(alpha = 0.3) + theme_bw() + labs(title = 'mother year of birth VS. covid time', fill = 'covid time group')
ftable(covid_time, nursing_setup_at_12mo)
ftable(covid_time, nursing_setup_at_12mo) / rowSums(ftable(covid_time, nursing_setup_at_12mo))
ftable(nursing_setup_at_12mo, covid_time) / rowSums(ftable(covid_time, nursing_setup_at_12mo))
ftable(covid_time, nursing_setup_at_12mo) / rowSums(ftable(covid_time, nursing_setup_at_12mo))
ftable(covid_time, nursing_setup_at_12mo)
ftable(covid_time, nursing_setup_at_12mo) / rowSums(ftable(covid_time, nursing_setup_at_12mo))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ xlab("covid_time") + ylab("percentage")
ftable(covid_time, nursing_setup_at_12mo) / rowSums(ftable(covid_time, nursing_setup_at_12mo))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ xlab("covid_time") + ylab("percentage") + geom_text(aes(label = round(new_df_longer$mean,3)), vjust = 0, size = 3.5, fontface = "bold")
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ xlab("covid_time") + ylab("percentage")
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ labs(title = 'Type og nursing at first yeat VS covid time', x = ' ' , y = 'percentage')
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ labs(title = 'Type og nursing at first yeat VS covid time', x = ' ' , y = 'percentage', fill = 'Born at:')
ggplot(df, aes(mother_year_birth, fill = as.factor(covid_time))) + geom_density(alpha = 0.3) + theme_bw() + labs(title = 'mother year of birth VS. covid time', fill = 'covid time group')
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ labs(title = 'Type og nursing at first yeat VS covid time', x = ' ' , y = 'percentage', fill = 'Born at:', labels = c('Up to March19','March19 - March20','March20 - Feb21'))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ labs(title = 'Type of nursing at first yeat VS covid time', x = ' ' , y = 'percentage', fill = 'Born at:', labels = c('Up to March19','March19 - March20','March20 - Feb21'))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + scale_fill_discrete(name = "nursing_setup_at_12mo")+ labs(title = 'Type of nursing at first year VS covid time', x = ' ' , y = 'percentage', fill = 'Born at:') + scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + labs(title = 'Type of nursing at first year VS covid time', x = ' ' , y = 'percentage', fill = 'Born at:') + scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + labs(title = 'Type of nursing at first year VS covid time', x = ' ' , y = 'percentage', fill = 'nursing type:') + scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
no_is_atopic = c('HRAD_first_year', 'AD_first_year', 'FA_first_year',
'HRAD_second_year', 'AD_second_year', 'FA_second_year')
atopic_longer_count <- df %>% select(c(no_is_atopic, covid_time,Born_at)) %>% drop_na() %>% group_by(covid_time, Born_at) %>% summarise_if(is.numeric, mean) %>% pivot_longer(cols  =no_is_atopic, names_to = "chronic_disease", values_to = "mean")
ggplot(atopic_longer_count, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + facet_wrap(~chronic_disease,4,2) +
geom_text(aes(label = round(atopic_longer_count$mean,3)), vjust = 0, size = 3.5, fontface = "bold") + theme_bw() +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("") + ylab('prop') + theme(axis.text.x = element_text( color = 'white'), text = element_text(size =12), strip.text = element_text(face = "bold")) + ylim(c(0,0.7))
#type_of_pregnancy
p = as.data.frame(with(df,table(covid_time,type_of_pregnancy))/rowSums(with(df,table(covid_time,type_of_pregnancy))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(type_of_pregnancy))) +
geom_col() + scale_fill_discrete(name = "type_of_pregnancy")+ xlab("covid_time") + ylab("percentage")
#type_of_pregnancy
p = as.data.frame(with(df,table(covid_time,type_of_pregnancy))/rowSums(with(df,table(covid_time,type_of_pregnancy))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(type_of_pregnancy))) +
geom_col() + scale_fill_discrete(name = "type_of_pregnancy")+ xlab("covid_time") + ylab("percentage")
other_var <- c('SES', 'number_of_children', 'preganancy_number','type_of_pregnancy', 'nursing_setup_at_12mo')
binary_longer <- df %>% select(c(prevention_therapy,steroids_treatment24, hospitalization_24_months,chronic_disease_24 , covid_time,Born_at)) %>% drop_na() %>% group_by(covid_time, Born_at) %>% summarise_if(is.numeric, mean) %>% gather(variables, mean, prevention_therapy:chronic_disease_24, factor_key=TRUE)# pivot_longer(cols = is_atopic, names_to = "chronic_disease", values_to = "mean")
ggplot(binary_longer, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + theme_bw() + facet_wrap(~variables) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("")+  ylab("proportion") + theme(axis.text.x = element_text(color = 'white')) +
geom_text(aes(label = round(binary_longer$mean,3)), vjust = 0, size = 3)
other_var <- c('SES', 'number_of_children', 'preganancy_number','type_of_pregnancy', 'nursing_setup_at_12mo')
binary_longer <- df %>% select(c(prevention_therapy,steroids_treatment24, hospitalization_24_months,chronic_disease_24 , covid_time,Born_at)) %>% drop_na() %>% group_by(covid_time, Born_at) %>% summarise_if(is.numeric, mean) %>% gather(variables, mean, prevention_therapy:chronic_disease_24, factor_key=TRUE)# pivot_longer(cols = is_atopic, names_to = "chronic_disease", values_to = "mean")
ggplot(binary_longer, aes(covid_time, y = mean, fill = as.factor(covid_time))) +
geom_col() + theme_bw() + facet_wrap(~variables) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21')) +
xlab("")+  ylab("proportion") + theme(axis.text.x = element_text(color = 'white')) +
geom_text(aes(label = round(binary_longer$mean,3)), vjust = 0, size = 3)
#SES
p = as.data.frame(with(df,table(covid_time,SES))/rowSums(with(df,table(covid_time,SES))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(SES))) +
geom_col() + scale_fill_discrete(name = "SES")+ xlab("covid_time") + ylab("percentage")
#number_of_children
p = as.data.frame(with(df,table(covid_time,number_of_children))/rowSums(with(df,table(covid_time,number_of_children))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(number_of_children))) +
geom_col() + scale_fill_discrete(name = "number_of_children")+ xlab("covid_time") + ylab("percentage")
#preganancy_number
p = as.data.frame(with(df,table(covid_time,preganancy_number))/rowSums(with(df,table(covid_time,preganancy_number))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(preganancy_number))) +
geom_col() + scale_fill_discrete(name = "preganancy_number")+ xlab("covid_time") + ylab("percentage")
#type_of_pregnancy
p = as.data.frame(with(df,table(covid_time,type_of_pregnancy))/rowSums(with(df,table(covid_time,type_of_pregnancy))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(type_of_pregnancy))) +
geom_col() + scale_fill_discrete(name = "type_of_pregnancy")+ xlab("covid_time") + ylab("percentage")
#nursing_setup_at_12mo
p = as.data.frame(with(df,table(covid_time,nursing_setup_at_12mo))/rowSums(with(df,table(covid_time,nursing_setup_at_12mo))))
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(nursing_setup_at_12mo))) +
geom_col() + labs(title = 'Type of nursing at first year VS covid time', x = ' ' , y = 'percentage', fill = 'nursing type:') + scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
ggplot(df %>% drop_na(), aes(covid_time, fill = as.factor(mother_education))) + geom_bar(position = "fill")
colnames(df)
ggplot(p,aes(x=as.factor(covid_time), y= Freq, fill = as.factor(SES))) +
geom_col() + labs(title = 'Type of nursing at first year VS covid time', x = ' ' , y = 'percentage', fill = 'nursing type:') + scale_x_discrete(labels = c('Up to March19','March19 - March20','March20 - Feb21')) + theme_bw()
library(corrplot)
df_binary_first<- df %>% select("Jew/Arab", "gender", "type_of_pregnancy", "family_Atopic_diseases", "mother_Atopic_diseases","father_Atopic_diseases", "sibling_Atopic_diseases", "HRAD_first_year", "AD_first_year", "FA_first_year", "ABX_fisrt_year", "is_atopic_first_year")
# libraries:
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(reshape)
library(glue)
options(scipen=5, digits = 5)
# Reading the file:
# dir <- "C:/Users/Merav/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_3.1.23.xlsx"
# dir <- "C:/Users/edena/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_3.1.23.xlsx"
dir<-"C:/Users/Shahar/Documents/GitHub/Statistics-Project/atopic_comorbidities_first_second_year_3.1.23.xlsx"
df <- read_excel(dir, sheet = 1)
df <- df %>% mutate(DOB = as.Date(DOB))
# Arranging df:
# Filtering only participants that completed the survey:
df <- df %>% filter(is.na(lost_of_followup))
# Filtering only participants that completed the second year:
df <- df %>% filter(month_survey_complete == 2)
# Removing non relevant columns: from type_of_allergy to 12_month_FA_type_allergy
#remove_columns = colnames(df)[51:88]
df <- df[,-c(51:88)]
# Removing columns with allot on NA:
not_relevant <- c('allergist_followup', 'last_spt', 'epipen', 'mistake_exposure', 'reaction_type24', 'diagnosis_by', 'lost_of_followup',"mother_no_comorbidities","mother_other","father_no_comorbidities","father_other","sibling1_other","sibling1_no_comorbidities","sibling2_other","sibling2_no_comorbidities","sibling3_other","sibling3_no_comorbidities","sibling4_other","sibling4_no_comorbidities")
df <- df[-which(colnames(df) %in% not_relevant)]
# Adding binary columns
# A. Did any one from family (mother, father, sib) have *any* of the disease?
df$family_Atopic_diseases_sum <- rowSums(df[,14:37])
# B. Did somebody from family have a specific disease?
# NEED TO FILL IN
# C. Did a disease appear in a specific family member?
df$mother_Atopic_diseases_sum <- rowSums(df[,14:17])
df$father_Atopic_diseases_sum <- rowSums(df[,18:21])
df$sibling_Atopic_diseases_sum <- rowSums(df[,22:37])
# Sibilings
df <- df %>% mutate(sibling_asthma_sum = sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma,
sibling_AD_sum = sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis,
sibling_Allergic_rhinitis_sum = sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis,
sibling_FA_sum = sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy)
df <- df %>% mutate(family_Atopic_diseases = ifelse(family_Atopic_diseases_sum >0,1,0),
mother_Atopic_diseases = ifelse(mother_Atopic_diseases_sum>0,1,0),
father_Atopic_diseases = ifelse(father_Atopic_diseases_sum > 0, 1,0),
sibling_Atopic_diseases = ifelse(sibling_Atopic_diseases_sum > 0 ,1, 0))
# Changing to binary variables:
df$gender[df$gender == 2] <- 0
df$`Jew/Arab`[df$`Jew/Arab` == 2] <- 0
df$food_allergy_24_month[df$food_allergy_24_month == 2] <- 0
df$inhalation_24_month[df$inhalation_24_month == 2] <- 0
df$prevention_therapy[df$prevention_therapy == 2] <- 0
df$AD_24_month[df$AD_24_month == 2] <- 0
df$steroids_treatment24[df$steroids_treatment24 == 2] <- 0
df$ABX_treatment_24_months[df$ABX_treatment_24_months == 2] <- 0
df$hospitalization_24_months[df$hospitalization_24_months == 2] <- 0
df$chronic_disease_24[df$chronic_disease_24 == 2] <- 0
df$type_of_pregnancy[df$type_of_pregnancy == 2] <- 0
#Changing NA to 0 for
df$number_ABX_treatment_24_months<- replace(df$number_ABX_treatment_24_months, is.na(df$number_ABX_treatment_24_months), 0)
df$hospitalization_24_months<- replace(df$hospitalization_24_months, is.na(df$hospitalization_24_months), 0)
df$prevention_therapy<- replace(df$prevention_therapy, is.na(df$prevention_therapy), 0)
df$number_inhalation<- replace(df$number_inhalation, is.na(df$number_inhalation), 0)
df$AD_treatment_24_month<- replace(df$AD_treatment_24_month, is.na(df$AD_treatment_24_month), 0)
df$steroids_treatment24<- replace(df$steroids_treatment24, is.na(df$steroids_treatment24), 0)
df$number_steroid_treat<- replace(df$number_steroid_treat
, is.na(df$number_steroid_treat), 0)
df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% drop_na(AD_first_year, FA_first_year, ABX_fisrt_year,food_allergy_24_month, inhalation_24_month, AD_24_month)
#Creating dependent variables:
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year + ABX_fisrt_year + HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_24_month + FA_second_year + ABX_second_year + HRAD_second_year)>0,1,0))
#option B of explanatory var:
#From mail
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
table(df$covid_time)
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
df <- df %>% mutate(
family_asthma = ifelse(mother_asthma + father_asthma + sibling1_asthma + sibling2_asthma + sibling3_asthma + sibling4_asthma >0,1,0),
family_AD = ifelse(mother_atopic_dermatitis + father_atopic_dermatitis + sibling1_atopic_dermatitis + sibling2_atopic_dermatitis + sibling3_atopic_dermatitis + sibling4_atopic_dermatitis >0,1,0),
family_Allergic_rhinitis = ifelse(mother_Allergic_rhinitis + father_Allergic_rhinitis + sibling1_Allergic_rhinitis + sibling2_Allergic_rhinitis + sibling3_Allergic_rhinitis + sibling4_Allergic_rhinitis >0,1,0),
family_FA = ifelse(mother_food_allergy + father_food_allergy + sibling1_food_allergy + sibling2_food_allergy + sibling3_food_allergy + sibling4_food_allergy >0,1,0))
# at this moment there is no sutible data from group 4 - post corona
attach(df)
library(corrplot)
df_binary_first<- df %>% select("Jew/Arab", "gender", "type_of_pregnancy", "family_Atopic_diseases", "mother_Atopic_diseases","father_Atopic_diseases", "sibling_Atopic_diseases", "HRAD_first_year", "AD_first_year", "FA_first_year", "ABX_fisrt_year", "is_atopic_first_year")
df_binary_second<- df %>% select("Jew/Arab", "gender", "type_of_pregnancy", "family_Atopic_diseases", "mother_Atopic_diseases","father_Atopic_diseases", "sibling_Atopic_diseases", "vaccine_12mo", "prevention_therapy", "vaccines_24month", "steroids_treatment24", "hospitalization_24_months", "chronic_disease_24", "food_allergy_24_month", "inhalation_24_month", "AD_24_month", "is_atopic_second_year")
cor_1<- cor(df_binary_first, method = c("spearman"), use="pairwise.complete.obs")
corrplot(cor_1, method = 'color', order = 'FPC', type = 'lower', diag = FALSE, col = COL2('BrBG'))
cor_2<- cor(df_binary_second, method = c("spearman"), use="pairwise.complete.obs")
corrplot(cor_2, method = 'color', order = 'FPC', type = 'lower', diag = FALSE, col=COL2('BrBG'))
attach(df)
cor(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year, is_atopic_second_year)
cor(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year, is_atopic_second_year)
cor(c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year))
cor(c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year), c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year))
cor(c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year), c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year),use = "everything" )
cor(c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year), c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year),use = "all.obs" )
cor(, c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year),use = "pairwise.complete.obs" )
cor(, c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year),use = "pairwise.complete.obs" )
x <- c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year)
cor(x, x, use = "pairwise.complete.obs" )
cor(x, x, use = "pairwise.complete.obs" )
x
x <- df %>% select(c(number_inhalation, number_of_ABX_first_year, number_steroid_treat, is_atopic_first_year,is_atopic_second_year))
x
cor(x, x, use = "pairwise.complete.obs" )
cor(x,  use = "pairwise.complete.obs" )
cor_1 <- cor(x,  use = "pairwise.complete.obs" )
corrplot(cor_1, method = 'color', order = 'FPC', type = 'lower', diag = FALSE, col = COL2('BrBG'))
