df$number_of_ABX_first_year<- replace(df$number_of_ABX_first_year, is.na(df$number_of_ABX_first_year), 0)
df <- df %>% mutate(SES_group = ifelse(SES>8, '9-10', ifelse(SES>5, '6-8', '1-5')))# create a category SES variable :
#Creating dependent variables with the correct name
df$FA_second_year <-  df$food_allergy_24_month
df$AD_second_year <- df$AD_24_month
df$HRAD_second_year <- df$inhalation_24_month
df$ABX_second_year <- df$ABX_treatment_24_months
df$feeding_type <- df$study_group_COMEET
#option A of explanatory var:
df <- df %>% mutate(is_atopic_first_year = ifelse((AD_first_year + FA_first_year +  HRAD_first_year)>0,1,0),
is_atopic_second_year = ifelse((AD_second_year + FA_second_year + HRAD_second_year)>0,1,0))
#Choosing explanatory variables: Ones that have a sufficient number of observation before and after Corona
#The distribution of observations according to the timeline of the corona. Before the corona = 1, the first six months of the corona = 2  and after = 3:
group1 <- as.Date("2019-03-01")
group2 <- as.Date("2020-03-11")
group3 <- as.Date("2021-02-07")
g1 <- as.numeric(as.Date("2019-03-01")) - min(as.numeric(as.Date(df$DOB)))
g2 <- as.numeric(as.Date("2020-03-11")) - min(as.numeric(as.Date(df$DOB)))
g3 <- as.numeric(as.Date("2021-02-07")) - min(as.numeric(as.Date(df$DOB)))
df$DOB_count = as.numeric(as.Date(df$DOB)) - min(as.numeric(as.Date(df$DOB)))
df <- df %>% mutate(covid_time = ifelse(DOB < group1, 1, ifelse(DOB < group2, 2, ifelse(DOB<group3, 3, 4))))
df <- df %>% mutate(Born_at = ifelse(covid_time == 1, 'Up to March19', ifelse(covid_time == 2, 'March19 - March20', 'March20 - Feb21')))
# Change categorical variable to factors
df$feeding_type <- as.factor(df$feeding_type)
df$gender <- as.factor(df$gender)
df$mother_Atopic_diseases <- as.factor(df$mother_Atopic_diseases)
df$father_Atopic_diseases <- as.factor(df$father_Atopic_diseases)
df$mother_education <- as.factor(df$mother_education)
df$type_of_pregnancy <- as.factor(df$type_of_pregnancy)
df$nursing_setup_at_12mo <- as.factor(df$nursing_setup_at_12mo)
df$covid_time <- as.factor(df$covid_time)
## preapre the final data frame for the models
df_mdl <- df %>% drop_na(SES_group, gender, type_of_pregnancy, mother_education, vaccine_12mo, nursing_setup_at_12mo, is_atopic_first_year, is_atopic_second_year) %>%
filter(mother_year_birth >1960, mother_year_birth < 2000) %>%
mutate(is_atopic_both = ifelse(is_atopic_first_year >0, ifelse(is_atopic_second_year>0, 1, 0),0), is_atopic_any = ifelse(is_atopic_first_year + is_atopic_second_year >0,1,0))
#reduce variance from this variable
df_mdl$mother_year_birth = df_mdl$mother_year_birth - 1961
attach(df_mdl)
n_df = df_mdl %>% group_by(covid_time ) %>% summarise(n = n(), is_atopic_first_year = sum(is_atopic_first_year), is_atopic_second_year = sum(is_atopic_second_year), is_atopic_any = sum(is_atopic_any), is_atopic_both = sum(is_atopic_both))
n_df <- n_df %>% mutate(is_atopic_first_year_perc = round(100*is_atopic_first_year/n),
is_atopic_second_year_perc = round(100*is_atopic_second_year/n),
is_atopic_any_perc = round(100*is_atopic_any/n),
is_atopic_both_perc = round(100*is_atopic_both/n))
plot_df <- data.frame(covid_time = rep(c(1,2,3,4), 4),
atopic = c(rep('1) First year',4), rep('2) Secound year',4), rep('3) First or Second year',4), rep('4) First and Second',4)) ,
precent = c(n_df$is_atopic_first_year_perc, n_df$is_atopic_second_year_perc, n_df$is_atopic_any_perc, n_df$is_atopic_both_perc))
Descriptive_plot <-  ggplot(plot_df, aes(covid_time, y = precent, fill = as.factor(covid_time))) +
geom_col() + theme_bw() + facet_wrap(~atopic, nrow=1) +
scale_fill_manual(values=c('dodgerblue4', 'darkorange1', 'green4', 'red4'),
name = "Born at", labels =c('Up to March19','March19 - March20','March20 - Feb21', 'From Feb21')) + ylim(c(0,100)) +
xlab("")+  ylab("Atopic disease (%)") +
theme(axis.text.x = element_text(color = 'white'), text = element_text(size =12), strip.text = element_text(face = "bold")) + labs(title = 'The percentage of babies with atopic disease') +
geom_text(aes(label = round(plot_df$precent,3)), vjust = 0, size = 3.5, fontface = "bold")
# ggsave('Descriptive_plot.jpeg',Descriptive_plot, width =10, height =3)
Descriptive_plot
n_df
covid_time_table <- function(kpi){
return(list(perc = round(ftable(covid_time, df[[kpi]]) / rowSums(ftable(covid_time, df[[kpi]])),3),
n = table(covid_time, df[[kpi]])))}
# sapply(binari_exp, covid_time_table, simplify =FALSE)
# sapply(discrite_exp, covid_time_table, simplify =FALSE)
# sapply(categoric_exp, covid_time_table, simplify =FALSE)
# sapply(exploreatory_variables, covid_time_table, simplify =FALSE)
# n1  = n_df[[1,'n']]
# n2  = n_df[[2,'n']]
# n3  = n_df[[3,'n']]
# n4  = n_df[[4,'n']]
mdl1 <- glm(is_atopic_first_year ~ SES_group + gender + type_of_pregnancy +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children + covid_time  , data = df_mdl, family = "binomial")
mdl2 <- glm(is_atopic_second_year ~ SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy  + vaccine_12mo  + nursing_setup_at_12mo + covid_time , data=df_mdl, family='binomial')
mdl2_atopic <- glm(is_atopic_second_year ~ is_atopic_first_year + SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy  + vaccine_12mo  + nursing_setup_at_12mo + covid_time, data=df_mdl, family='binomial')
summary(mdl1)
# summary(mdl2)
# summary(mdl2_atopic)
confint(mdl1, level=0.9)
gam1 <- gam(is_atopic_first_year ~ SES_group + gender + type_of_pregnancy +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
s(DOB_count, bs='cr') ,data=df_mdl, family=binomial)
gam2 <- gam(is_atopic_second_year ~ SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy  + vaccine_12mo  + nursing_setup_at_12mo + s(DOB_count, bs='cr'), data=df_mdl, family=binomial)
gam2_atopic <- gam(is_atopic_second_year ~ is_atopic_first_year + SES_group + gender +
mother_Atopic_diseases + father_Atopic_diseases +
mother_year_birth + mother_education + number_of_children +
type_of_pregnancy  + vaccine_12mo  + nursing_setup_at_12mo + s(DOB_count, bs='cr') ,data=df_mdl, family=binomial)
# summary(gam1)
# summary(gam2)
# summary(gam2_atopic)
# plot.gam(gam2_atopic)
res_log1 = as.data.frame(summary(mdl1)$coefficients)
ci_1 = as.data.frame(confint.lm(mdl1, level = 0.9))
res_log1$lower_ci <- ci_1$`5 %`
res_log1$upper_ci <- ci_1$`95 %`
df_gam1 <- plot(getViz(gam1))$plots[[1]]$data$fit
df_gam1 <- df_gam1 %>% mutate(Born_at = if_else(x< g1, 'Up to March19', ifelse(x<g2, 'March19 - March20', ifelse(x<g3,'March20 - Feb21','From Feb21'))))
df_gam1$Born_at <- as.factor(df_gam1$Born_at)
df_gam1 <- df_gam1 %>%
mutate(y_log = if_else(x < g1, 0, ifelse(x<g2, mdl1$coefficients['covid_time2'] ,
ifelse(x<g3 ,mdl1$coefficients['covid_time3'],
mdl1$coefficients['covid_time4']))),
ci_lower = if_else(x < g1, 0,
ifelse(x<g2, res_log1['covid_time2', 'lower_ci'],
ifelse(x<g3 , res_log1['covid_time3', 'lower_ci'],
res_log1['covid_time4', 'lower_ci']))),
ci_upper = if_else(x < g1, 0,
ifelse(x<g2, res_log1['covid_time2', 'upper_ci'],
ifelse(x<g3 , res_log1['covid_time3', 'upper_ci'],
res_log1['covid_time4', 'upper_ci']))))
#set dates
plus = min(as.numeric(as.Date(df$DOB)))
df_gam1 <- df_gam1 %>% mutate(Date = as.Date(x + plus,  origin = '1970-01-01'))
# ## with Intercept:
# g1_interc = gam1$coefficients[1]
# l1_interc = mdl1$coefficients[1]
#
# df_gam1$y <- df_gam1$y + g1_interc
# df_gam1$y_log <- df_gam1$y_log + l1_interc
#
# plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
#   geom_line(aes(col = Born_at), size = 1) +
#   geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
#
#   geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
#   geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), alpha = 0.1)+
#
#   scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
#   labs(title = "Birth date coefficient distribution", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
#   geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2) +
#   scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
#
# # ggsave('full_first_year_mdl.jpeg',plot1_first_year, width =8, height =6)
# plot1_first_year
res_log2 = as.data.frame(summary(mdl2)$coefficients)
ci_2 = as.data.frame(confint.lm(mdl2, level = 0.9))
res_log2$lower_ci <- ci_2$`5 %`
res_log2$upper_ci <- ci_2$`95 %`
df_gam2 <- plot(getViz(gam2))$plots[[1]]$data$fit
df_gam2 <- df_gam2 %>% mutate(Born_at = if_else(x< g1, 'Up to March19',
ifelse(x<g2, 'March19 - March20', ifelse(x<g3,'March20 - Feb21','From Feb21'))))
df_gam2$Born_at <- as.factor(df_gam2$Born_at)
df_gam2 <- df_gam2 %>% mutate(y_log = if_else(x < g1, 0,
ifelse(x<g2, mdl2$coefficients['covid_time2'] ,
ifelse(x<g3 ,mdl2$coefficients['covid_time3'],
mdl2$coefficients['covid_time4']))),
ci_lower = if_else(x < g1, 0,
ifelse(x<g2, res_log2['covid_time2', 'lower_ci'] ,
ifelse(x<g3 , res_log2['covid_time3', 'lower_ci'],
res_log2['covid_time4', 'lower_ci']))),
ci_upper = if_else(x < g1, 0,
ifelse(x<g2, res_log2['covid_time2', 'upper_ci'] ,
ifelse(x<g3 , res_log2['covid_time3', 'upper_ci'],
res_log2['covid_time4', 'upper_ci']))))
#
# #set dates
# plus = min(as.numeric(as.Date(df$DOB)))
# df_gam2 <- df_gam2 %>% mutate(Date = as.Date(x + plus,  origin = '1970-01-01'))
#
# ## with Intercept:
# g2_interc = gam2$coefficients[1]
# l2_interc = mdl2$coefficients[1]
#
# df_gam2$y <- df_gam2$y + g2_interc
# df_gam2$y_log <- df_gam2$y_log + l2_interc
#
# plot2_second_year <- ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
#   geom_line(aes(col = Born_at), size = 1) +
#   geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
#
#   geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
#   geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), alpha = 0.1)+
#
#   scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
#   labs(title = "Birth date coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
#   geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
#   scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
#
# # ggsave('full_second_year_mdl.jpeg',plot2_second_year, width =8, height =6)
# plot2_second_year
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
res_log2 = as.data.frame(summary(mdl2)$coefficients)
ci_2 = as.data.frame(confint.lm(mdl2, level = 0.9))
res_log2$lower_ci <- ci_2$`5 %`
res_log2$upper_ci <- ci_2$`95 %`
df_gam2 <- plot(getViz(gam2))$plots[[1]]$data$fit
df_gam2 <- df_gam2 %>% mutate(Born_at = if_else(x< g1, 'Up to March19',
ifelse(x<g2, 'March19 - March20', ifelse(x<g3,'March20 - Feb21','From Feb21'))))
df_gam2$Born_at <- as.factor(df_gam2$Born_at)
df_gam2 <- df_gam2 %>% mutate(y_log = if_else(x < g1, 0,
ifelse(x<g2, mdl2$coefficients['covid_time2'] ,
ifelse(x<g3 ,mdl2$coefficients['covid_time3'],
mdl2$coefficients['covid_time4']))),
ci_lower = if_else(x < g1, 0,
ifelse(x<g2, res_log2['covid_time2', 'lower_ci'] ,
ifelse(x<g3 , res_log2['covid_time3', 'lower_ci'],
res_log2['covid_time4', 'lower_ci']))),
ci_upper = if_else(x < g1, 0,
ifelse(x<g2, res_log2['covid_time2', 'upper_ci'] ,
ifelse(x<g3 , res_log2['covid_time3', 'upper_ci'],
res_log2['covid_time4', 'upper_ci']))))
#
# #set dates
# plus = min(as.numeric(as.Date(df$DOB)))
# df_gam2 <- df_gam2 %>% mutate(Date = as.Date(x + plus,  origin = '1970-01-01'))
#
# ## with Intercept:
# g2_interc = gam2$coefficients[1]
# l2_interc = mdl2$coefficients[1]
#
# df_gam2$y <- df_gam2$y + g2_interc
# df_gam2$y_log <- df_gam2$y_log + l2_interc
#
# plot2_second_year <- ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
#   geom_line(aes(col = Born_at), size = 1) +
#   geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
#
#   geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
#   geom_ribbon(aes(ymin = y_log - se_log*qnorm(0.975), ymax = y_log + se_log*qnorm(0.975), y=NULL), alpha = 0.1)+
#
#   scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
#   labs(title = "Birth date coefficient distribution", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
#   geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
#   scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
#
# # ggsave('full_second_year_mdl.jpeg',plot2_second_year, width =8, height =6)
# plot2_second_year
log_plot1_first_year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
df_gam2
ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)
ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2)
df_gam2
#set dates
plus = min(as.numeric(as.Date(df$DOB)))
df_gam2 <- df_gam2 %>% mutate(Date = as.Date(x + plus,  origin = '1970-01-01'))
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
# ggsave('Logistic_model_first_year.jpeg',log_plot1_first_year, width =8, height =6)
# ggsave('Logistic_model_second_year.jpeg',Log_plot2_second_year, width =8, height =6)
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.1) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.1)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
# ggsave('Logistic_model_first_year.jpeg',log_plot1_first_year, width =8, height =6)
# ggsave('Logistic_model_second_year.jpeg',Log_plot2_second_year, width =8, height =6)
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.1) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1, linetype=2) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.1)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
# ggsave('Logistic_model_first_year.jpeg',log_plot1_first_year, width =8, height =6)
# ggsave('Logistic_model_second_year.jpeg',Log_plot2_second_year, width =8, height =6)
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
# ggsave('Logistic_model_first_year.jpeg',log_plot1_first_year, width =8, height =6)
# ggsave('Logistic_model_second_year.jpeg',Log_plot2_second_year, width =8, height =6)
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
# ggsave('Logistic_model_first_year.jpeg',log_plot1_first_year, width =8, height =6)
# ggsave('Logistic_model_second_year.jpeg',Log_plot2_second_year, width =8, height =6)
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2, size=2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2, size=1)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2, size=1) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2, size=1) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2, size=1)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
ggsave('Logistic_model_first_year.jpeg',log_plot1_first_year, width =8, height =6)
ggsave('Logistic_model_second_year.jpeg',Log_plot2_second_year, width =8, height =6)
# Log plot first year
# אולי כדאי לשנות את הויזואליזציה כדי שיהיה יותר ברור מה אנחנו רואים במודל של הרגרסיה הלוגיסטית
log_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2, size=1) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
log_plot1_first_year
# Log plot second year
Log_plot2_second_year <- ggplot(df_gam2, aes(Date, y, fill = Born_at)) +
geom_line(aes(Date, y_log, col = Born_at), size = 1) +
geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper, y=NULL), alpha = 0.1)+
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date group coefficient - Logistic model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'Coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2, size=1)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
Log_plot2_second_year
ggsave('Logistic_model_first_year.jpeg',log_plot1_first_year, width =8, height =6)
ggsave('Logistic_model_second_year.jpeg',Log_plot2_second_year, width =8, height =6)
# GAM plot fort year
GAM_plot1_first_year <- ggplot(df_gam1, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - GAM model", subtitle ="During the first year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2) +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
GAM_plot1_first_year
# GAM plot second year
GAM_plot2_second_year <- ggplot(df_gam2, aes(Date,y, fill = Born_at)) +
geom_line(aes(col = Born_at), size = 1) +
geom_ribbon(aes(ymin = y - se*qnorm(0.975), ymax = y + se*qnorm(0.975), y=NULL), alpha = 0.1) +
scale_color_manual(values=viridis(5)) + scale_fill_manual(values=viridis(5)) + theme_bw() +
labs(title = "Birth date coefficient distribution - GAM model", subtitle ="During the second year of a baby's life", x = 'Birth date', y = 'coefficient')+
geom_hline(yintercept = 0, linetype='dashed', alpha = 0.2)  +
scale_x_date(date_breaks = "4 months", date_labels = "%b\n%y") + theme(legend.position = "none")
GAM_plot2_second_year
# ggsave('GAM_model_first_year.jpeg',GAM_plot1_first_year, width =8, height =6)
# ggsave('GAM_model_second_year.jpeg',GAM_plot2_second_year, width =8, height =6)
ggsave('GAM_model_first_year.jpeg',GAM_plot1_first_year, width =8, height =6)
ggsave('GAM_model_second_year.jpeg',GAM_plot2_second_year, width =8, height =6)
ggsave('GAM_model_first_year.jpeg',GAM_plot1_first_year, width =8, height =6)
ggsave('GAM_model_second_year.jpeg',GAM_plot2_second_year, width =8, height =6)
summary(gam1)
x <- summary(gam1)
x$p.coeff
x$se
x$p.t
x
x$m
x$edf
x$cov.scaled
x$s.table
View(x)
